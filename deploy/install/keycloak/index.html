<!doctype html><html lang=en class="js csstransforms3d"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-0PJKXDWQ4P"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0PJKXDWQ4P")}</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=referrer content="no-referrer-when-downgrade"><meta property="og:image" content="https://docs.rhize.com/images/rhize-logo.png"><meta property="og:image:secure_url" content="https://docs.rhize.com/images/rhize-logo.png"><meta property="og:description" content="The Rhize GraphQL implementation uses OpenIDConnect for Authentication and role-based access control. This section describes how to set up Keycloak"><meta property="og:type" content="website"><meta property="og:title" content="Configure Keycloak"><meta property="og:site_name" content="Rhize documentation"><meta property="og:url" content="https://docs.rhize.com/deploy/install/keycloak/"><meta property="og:locale" content="en"><meta name=generator content="Hugo 0.129.0"><meta name=description content="The Rhize GraphQL implementation uses OpenIDConnect for Authentication and role-based access control. This section describes how to set up Keycloak"><link rel=canonical href=https://docs.rhize.com/deploy/install/keycloak/><link rel=apple-touch-icon sizes=57x57 href=https://docs.rhize.com/images/favicons/apple-touch-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=https://docs.rhize.com/images/favicons/apple-touch-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=https://docs.rhize.com/images/favicons/apple-touch-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=https://docs.rhize.com/images/favicons/apple-touch-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=https://docs.rhize.com/images/favicons/apple-touch-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=https://docs.rhize.com/images/favicons/apple-touch-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=https://docs.rhize.com/images/favicons/apple-touch-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=https://docs.rhize.com/images/favicons/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=https://docs.rhize.com/images/favicons/apple-touch-icon-180x180.png><link rel=icon type=image/png href=https://docs.rhize.com/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://docs.rhize.com/images/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=https://docs.rhize.com/images/favicons/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=https://docs.rhize.com/images/favicons/favicon-16x16.png sizes=16x16><link rel=manifest href=https://docs.rhize.com/images/favicons/manifest.webmanifest><link rel=mask-icon href=https://docs.rhize.com/images/favicons/safari-pinned-tab.svg color=#fe2c06><link rel="shortcut icon" href=https://docs.rhize.com/images/favicons/favicon.ico><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/default.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js></script><script async src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/languages/go.min.js></script><script async src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/languages/java.min.js integrity="sha256-RyOs5MjQ+Ef9DQrPHp4QGr2tcNjxLh6mCkkW+sS4doU=" crossorigin=anonymous></script><script src=//code.jquery.com/jquery-3.2.1.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><title>Configure Keycloak
|
Deploy
</title><link href=https://docs.rhize.com/css/theme.css?07639695cdaf2b91d81cbbea8d450140 rel=stylesheet><link href=https://docs.rhize.com/css/runnable.css?46648956d99faa2e057d109b9f2a52e6 rel=stylesheet><link href=https://docs.rhize.com/css/tabs.css?035edc32762cb7973b740e3067101ced rel=stylesheet><link href=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css rel=stylesheet integrity=sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ crossorigin=anonymous><script src=//cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js integrity=sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js integrity=sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn crossorigin=anonymous></script><link href="//fonts.googleapis.com/css?family=Lato:400,700" rel=stylesheet><link href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css rel=stylesheet integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous><link href=https://cdn.lineicons.com/2.0/LineIcons.css rel=stylesheet crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3></head><body><nav id=header><div class=header-left><div><a href=https://docs.rhize.com/ class=brand><img src=https://docs.rhize.com//images/rhize-logo.png alt=RHIZE class=logo></a><div class=logo-tagline><span>Documentation</span></div></div></div><div class=header-right><div id=docsearch><div class="menu-search align-middle"><div id=docsearch></div></div></div><div><ul class=menu><li><a href=https://rhize.com target=_blank>Home</a></li><li><a href=https://forum.rhize.com target=_blank>Community</a></li><li><a href=https://www.youtube.com/@rhizemanufacturingdatahub target=_blank>Youtube</a></li></ul></div></div><a href=# id=sidebar-toggle><i class="fa fa-bars"></i></a></nav><aside id=sidebar><ul class=topics><li class="topic main-topic children"><a id=get-started href=#>Get started</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/get-started/introduction/>What is Rhize?</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/get-started/how-rhize-works/>How Rhize works</a></li></ul></li><li class="topic main-topic children active"><a id=deploy href=#>Deploy</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic active"><a href=#>Install</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/install/overview/>Overview</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/install/setup-kubernetes/>Set up Kubernetes</a></li><li class="topic sub-topic active"><a href=https://docs.rhize.com/deploy/install/keycloak/>Configure Keycloak</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/install/services/>Install Rhize services</a></li></ul></li><li class="topic sub-topic"><a href=#>Back up</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/backup/graphdb/>Back up the Graph DB</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/backup/audit/>Back up Audit PostgreSQL</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/backup/grafana/>Back up Grafana</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/backup/keycloak/>Back up Keycloak</a></li></ul></li><li class="topic sub-topic"><a href=#>Restore</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/restore/graphdb/>Restore the GraphDB</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/restore/audit/>Restore Audit backup</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/restore/grafana/>Restore Grafana</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/restore/keycloak/>Restore Keycloak</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/restore/bpmn-nodes/>BPMN execution recovery</a></li></ul></li><li class="topic sub-topic"><a href=#>Maintain</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/maintain/audit/>Archive the PostgreSQL Audit trail</a></li></ul></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/upgrade/>Upgrade</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/about-openidconnect/>About OpenID connect</a></li></ul></li><li class="topic main-topic children"><a id=user-guides href=#>User guides</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=#>Use GraphQL</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/call-the-graphql-api/>Overview: the Rhize API</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/query/>Query</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/filter/>Filter</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/mutate/>Mutate</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/subscribe/>Subscribe</a></li></ul></li><li class="topic sub-topic"><a href=#>Write BPMN workflows</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/create-workflow/>Overview: orchestrate processes</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/trigger-workflows/>Trigger workflows</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/use-jsonata/>Use JSONata</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/debug-workflows/>Handle errors and debug</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/tune-performance/>Tune performance</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/variables/>Special variables</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/naming-conventions/>Naming conventions</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/learning-resources/>BPMN learning resources</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/bpmn-elements/>BMPN elements</a></li></ul></li><li class="topic sub-topic"><a href=#>Define production models</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/model/create-objects-ui/>Create objects from the UI</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/model/master-definitions/>Master definitions and fields</a></li></ul></li><li class="topic sub-topic"><a href=#>Connect event data</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/publish-subscribe/connect-datasource/>Connect data source</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/publish-subscribe/create-equipment-class-rule/>Tutorial: Trigger a workflow from a rule</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/publish-subscribe/track-changes/>Track changes (CDC)</a></li></ul></li><li class="topic sub-topic"><a href=#>Use work calendars</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/work-calendars/about-calendars-and-overrides/>About calendars and overrides</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/work-calendars/create-work-calendar/>Create work calendars</a></li></ul></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/audit/>Audit</a></li></ul></li><li class="topic main-topic children"><a id=use-cases href=#>Use cases</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/use-cases/overview/>Overview</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/use-cases/genealogy/>Genealogy</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/use-cases/ebr/>Electronic batch records</a></li></ul></li><li class="topic main-topic children"><a id=reference href=#>Reference</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=#>Service configuration</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/agent-configuration/>Agent configuration</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/audit-configuration/>Audit configuration</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/bpmn-configuration/>BPMN configuration</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/calendar-configuration/>Calendar Service configuration</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/core-configuration/>Core configuration</a></li></ul></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/default-ports/>Default URLs and local ports</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/gql-types/>GQL types and filters</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/glossary/>Glossary</a></li></ul></li><li class="topic main-topic children"><a id=explanations href=#>Explanations</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/explanations/manufacturing-data-hub/>Manufacturing Data Hub</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/explanations/isa-95-diagrams/>ISA-95 diagrams</a></li></ul></li><li class="topic main-topic children"><a id=releases href=#>Releases</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/3-0/>3.0.0</a></li><li class="topic sub-topic"><a href=#>Changelog</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0/>3.0.0 (general release)</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc09/>3.0.0rc09</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc08/>3.0.0rc08</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc07/>3.0.0rc07</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc06/>3.0.0rc06</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc05/>3.0.0rc05</a></li></ul></li></ul></li><li class="topic main-topic"><a href=https://docs.rhize.com/></a></li></ul></aside><script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script><script type=text/javascript>docsearch({appId:"70JLDGIDQA",apiKey:"2b4c57aa9d3d0386bf1a6df5b54eb3cf",indexName:"rhize",insights:!0,container:"#docsearch",debug:!1})</script></body></html><main class=content-wrapper><div class=content><div class=top-toc><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#steps>Steps</a><ul><li><a href=#log-in>Log in</a></li><li><a href=#create-a-realm>Create a realm</a></li><li><a href=#create-clients>Create clients</a></li><li><a href=#scope-services>Scope services</a></li><li><a href=#create-roles-and-groups>Create roles and groups</a></li><li><a href=#add-client-policy>Add Client Policy</a></li><li><a href=#add-users>Add users</a></li></ul></li><li><a href=#enable-keycloak-audit-trail>Enable Keycloak Audit Trail</a></li><li><a href=#configure-password-policy>Configure password policy</a></li><li><a href=#configure-brute-force-protections>Configure brute-force protections</a></li><li><a href=#next-steps>Next steps</a></li></ul></nav></div><article><a class=edit-btn target=_blank href=https://github.com/libremfg/libremfg.github.io/edit/main/content/deploy/install/keycloak.md><i class="fa fa-github-alt"></i> Edit Page</a><h1 class=post-title>Configure Keycloak</h1><p>Rhize uses <a href=https://keycloak.org>Keycloak</a> as an OpenID provider.
In your cluster, the Keycloak server to authenticate users, services, and manage Role-based access controls.</p><p>This topic describes how to set up Keycloak in your Rhize cluster.
For a conceptual overview of the authentication flow, read <a href=https://docs.rhize.com/deploy/about-openidconnect/>About OpenID Connect</a></p><h2 id=prerequisites>Prerequisites</h2><p>First, ensure that you have followed the instructions from <a href=https://docs.rhize.com/deploy/install/setup-kubernetes>Set up Kubernetes</a>.
All prerequisites for that step apply here.</p><h2 id=steps>Steps</h2><p>Follow these steps to configure a Keycloak realm and associate Rhize services to Keycloak clients, groups, roles, and policies.</p><h3 id=log-in>Log in</h3><ol><li><p>Go to <code>localhost</code> on the port where you forwarded the URL. If you used the example values from the last step, that&rsquo;s <code>localhost:5101</code>.</p></li><li><p>Use the container credentials to log in.</p><p>To find this, look in the <code>keycloak.yaml</code> file.</p></li></ol><h3 id=create-a-realm>Create a realm</h3><p>A Keycloak <em>realm</em> is like a tenant that contains all configuration.</p><p>To create your Rhize realm, follow these steps.</p><ol><li>In the side menu, select <strong>Master</strong> then <strong>Create Realm</strong>.</li><li>For the <strong>Realm Name</strong>, enter <code>libre</code>. <strong>Create.</strong></li><li>In the side menu, select <strong>Realm Settings</strong>.</li><li>Enter the following values:<table><thead><tr><th>Field</th><th>value</th></tr></thead><tbody><tr><td>Frontend URL</td><td>Keycloak frontend URL</td></tr><tr><td>Require SSL</td><td>External requests</td></tr></tbody></table></li></ol><p>After you&rsquo;ve created the realm, you can create clients.</p><div class="notices note"><span class=type>Note</span> If created with the Libre Theme <code>init</code> container, configure the <strong>Login Theme</strong> in <strong>Realm settings</strong> for <code>libre</code>.</div><h3 id=create-clients>Create clients</h3><p>In Keycloak, <em>clients</em> are entities that request Keycloak to authenticate a user.
You need to create a client for each service.</p><p>The DB client requires additional configuration of flows and grants.
Other clients, such as the UI and Dashboard, use the standard flow to coordinate authorization between the browser and Keycloak to simplify security and improve user convenience.</p><div class="notices note"><span class=type>Note</span> Each standard-flow client has its own subdomain.
Refer to <a href=https://docs.rhize.com/reference/default-ports/>Default URLs and Ports</a> for our recommended conventions.</div><h4 id=create-db-client>Create DB client</h4><p>Create a client for the DB as follows:</p><ol><li><p>In the side menu, select <strong>Clients > create client</strong>.</p></li><li><p>Configure the <strong>General Settings</strong>:</p><ul><li><strong>Client Type</strong>: <code>OpenID Connect</code></li><li><strong>Client ID</strong>: <code>libreBaas</code></li><li><strong>Name</strong>: <code>Libre Backend as a Service</code></li><li><strong>Description</strong>: <code>Libre Backend as a Service</code></li></ul><p>When finished, select <strong>Next.</strong></p></li><li><p>Configure the <strong>Capability config</strong>:</p><ul><li><strong>Client Authentication</strong>: On</li><li><strong>Authorization</strong>: On</li><li>For <strong>Authentication flow</strong>, enable:<ul><li>🗸 Standard flow</li><li>🗸 Direct access grants</li><li>🗸 Implicit flow</li></ul></li></ul></li><li><p>Select <strong>Next</strong>, then <strong>Save</strong>.</p><p>On success, this opens the <strong>Client details</strong> page for the newly created client.</p></li><li><p>Select the <strong>Roles</strong> tab and add the following roles to the <code>libreBaas</code> service account:</p><ul><li><code>manage-clients</code></li><li><code>manage-account</code></li><li><code>manage-users</code></li></ul></li></ol><h4 id=create-ui-client>Create UI client</h4><p>Create a client for the UI as follows:</p><ol><li><p>In the side menu, select <strong>Clients > create client</strong>.</p></li><li><p>Configure the <strong>General Settings</strong>:</p><ul><li><strong>Client Type</strong>: <code>OpenID Connect</code></li><li><strong>Client ID</strong>: <code>libreUI</code></li><li><strong>Name</strong>: <code>Libre User Interface</code></li><li><strong>Description</strong>: <code>Libre User Interface</code></li></ul><p>When finished, select <strong>Next.</strong></p></li><li><p>Configure the <strong>Capability config</strong>:</p><ul><li><strong>Client Authentication</strong>: On</li><li><strong>Authorization</strong>: On</li><li>For <strong>Authentication flow</strong>, enable:<ul><li>🗸 Standard flow</li><li>🗸 Direct access grants</li><li>🗸 Implicit flow</li></ul></li></ul></li><li><p>Configure the <strong>Access Settings</strong>:</p><ul><li><strong>Root URL</strong>: <code>&lt;UI_SUBDOMAIN>.&lt;YOUR_DOMAIN></code> without trailing slashes</li><li><strong>Home URL</strong>: <code>&lt;UI_SUBDOMAIN>.&lt;YOUR_DOMAIN></code> without trailing slashes</li><li><strong>Web Origins</strong>: <code>&lt;UI_SUBDOMAIN>.&lt;YOUR_DOMAIN></code> without trailing slashes</li></ul></li><li><p>Select <strong>Next</strong>, then <strong>Save</strong>.</p></li></ol><h4 id=create-dashboard-client>Create dashboard client</h4><ol><li><p>In the side menu, select <strong>Clients > create client</strong>.</p></li><li><p>Configure the <strong>General Settings</strong>:</p><ul><li><strong>Client Type</strong>: <code>OpenID Connect</code></li><li><strong>Client ID</strong>: <code>dashboard</code></li><li><strong>Name</strong>: <code>Libre Dashboard</code></li><li><strong>Description</strong>: <code>Libre Dashboard</code></li></ul></li><li><p>Configure the <strong>Capability config</strong>:</p><ul><li><strong>Client Authentication</strong>: On</li><li><strong>Authorization</strong>: On</li><li>For <strong>Authentication flow</strong>, enable:<ul><li>🗸 Standard flow</li><li>🗸 Direct access grants</li><li>🗸 Implicit flow</li></ul></li></ul></li><li><p>Configure the <strong>Access Settings</strong>:</p><ul><li><strong>Root URL</strong>: <code>&lt;DASHBOARD_SUBDOMAIN>.&lt;YOUR_DOMAIN></code> without trailing slashes</li><li><strong>Home URL</strong>: <code>&lt;DASHBOARD_SUBDOMAIN>.&lt;YOUR_DOMAIN></code> without trailing slashes</li><li><strong>Valid redirect URIs</strong>: <code>&lt;DASHBOARD_URL>/login/generic_oauth</code> without trailing slashes</li><li><strong>Valid post logout redirect URIs</strong>: <code>+</code> without trailing slashes</li><li><strong>Home URL</strong>: <code>&lt;DASHBOARD_SUBDOMAIN>.&lt;YOUR_DOMAIN></code> without trailing slashes</li></ul></li><li><p>Select <strong>Next</strong>, then <strong>Save</strong>.</p></li></ol><h4 id=create-other-service-clients>Create other service clients</h4><p>The other services do not need authorization but do need client authentication.
By default you need to add only the client ID.</p><p>For example, to create the BPMN engine client:</p><ol><li>In the side menu, select <strong>Clients > create client</strong>.</li><li>For <strong>Client ID</strong>, enter <code>libreBpmn</code></li><li>Configure the <strong>Capability config</strong>:<ul><li><strong>Client Authentication</strong>: On</li></ul></li><li>Select <strong>Next</strong>, then <strong>Save</strong>.</li></ol><p><strong>Repeat this process for each of the following services:</strong></p><table><thead><tr><th>Client ID</th><th>Description</th></tr></thead><tbody><tr><td><code>libreAudit</code></td><td>The audit log service</td></tr><tr><td><code>libreCore</code></td><td>The edge agent</td></tr><tr><td><code>libreRouter</code></td><td>API router</td></tr></tbody></table><p>Based on your architecture, repeat for any Libre Edge Agents, <code>libreAgent</code>.</p><h3 id=scope-services>Scope services</h3><p>In Keycloak, a <em>scope</em> bounds the access a service has.
Rhize creates a default client scope, then binds services to that scope.</p><h4 id=create-a-client-scope>Create a client scope</h4><p>To create a scope for your Rhize services, follow these steps:</p><ol><li>Select <strong>Client Scopes > Create client scope</strong>.</li><li>Fill in the following values:<ul><li><strong>Name</strong>: <code>libreClientScope</code></li><li><strong>Description</strong>: <code>Libre Client Scope</code></li><li><strong>Type</strong>: <code>None</code></li><li><strong>Display on consent screen</strong>: <code>On</code></li><li><strong>Include in token scope</strong>: <code>On</code></li></ul></li><li><strong>Create</strong>.</li><li>Select the <strong>Mappers</strong> tab, then <strong>Configure new mapper</strong>. Add an audience mapper for the DB client:<ul><li><strong>Mapper Type</strong>: <code>Audience</code></li><li><strong>Name</strong>: <code>libreBaasAudienceMapper</code></li><li><strong>Include Client Audience</strong>: <code>libreBaas</code></li><li><strong>Add to ID Token</strong>: <code>On</code></li><li><strong>Add to access token</strong>: <code>On</code></li></ul></li><li>Repeat the preceding step for a mapper for the UI client:<ul><li><strong>Mapper Type</strong>: <code>Audience</code></li><li><strong>Name</strong>: <code>libreUIAudienceMapper</code></li><li><strong>Include Client Audience</strong>: <code>libreUI</code></li><li><strong>Add to ID Token</strong>: <code>On</code></li><li><strong>Add to access token</strong>: <code>Off</code></li></ul></li><li>If using the Rhize Audit microservice, repeat the preceding step for an Audit scope and audience mapper:<ul><li><strong>Mapper Type</strong>: <code>Audience</code></li><li><strong>Name</strong>: <code>libreAuditAudienceMapper</code></li><li><strong>Include Client Audience</strong>:</li><li><strong>Included Custom Audience</strong>: <code>audit</code></li><li><strong>Add to ID Token</strong>: <code>On</code></li><li><strong>Add to access token</strong>: <code>On</code></li></ul></li></ol><h4 id=add-services-to-the-scope>Add services to the scope</h4><ol><li>Go to <strong>Clients</strong>. Select <code>libreBaas</code>.</li><li>Select the <strong>Client Scopes</strong> tab.</li><li>Select <strong>Add Client scope</strong></li><li>Select <code>libreClientScope</code> from the list.</li><li><strong>Add > Default</strong>.</li></ol><p>Repeat this process for the <code>dashboard</code>, <code>libreUI</code>, <code>libreBpmn</code>, <code>libreCore</code>, <code>libreRouter</code>, <code>libreAudit</code> (if applicable). Based on your architecture repeat for any Libre Edge Agent clients.</p><h3 id=create-roles-and-groups>Create roles and groups</h3><p>In Keycloak, <em>roles</em> identify a category or type of user.
<em>Groups</em> are a common set of attributes for a set of users.</p><p>Rhize creates an <code>ADMIN</code> role and group.</p><h4 id=add-the-admin-realm-role>Add the admin realm role</h4><ol><li>Select <strong>Realm Roles</strong>. Then <strong>Create role</strong>.</li><li>Enter the following values:<ul><li>Role name: <code>ADMIN</code></li><li>Description: <code>ADMIN</code></li></ul></li><li><strong>Save</strong>.</li></ol><h4 id=add-the-admin-group>Add the Admin Group</h4><ol><li>In the left hand menu, select <strong>Groups > Create group</strong>.</li><li>Give the group a name like <code>libreAdminGroup</code>.</li><li><strong>Create</strong>.</li></ol><p>Now map a role.</p><ol><li>From the group list, select the group you just created.</li><li>Select the <strong>Role mapping</strong> tab.</li><li>Select <strong>Assign Role</strong></li><li>Select <code>ADMIN</code>.</li><li><strong>Assign.</strong></li></ol><h4 id=add-the-dashboard-realm-roles>Add the dashboard realm roles</h4><ol><li>Select <strong>Realm Roles</strong>, and then <strong>Create role</strong>.</li><li>Name the role <code>dashboard-admin</code>.</li><li><strong>Save</strong>.</li><li>Repeat the process to create a role <code>dashboard-dev</code>.</li></ol><h4 id=add-the-dashboard-groups>Add the dashboard groups</h4><ol><li>In the left hand menu, select <strong>Groups</strong>, and then <strong>Create Group</strong>.</li><li>Name the group <code>dashboard-admin</code></li><li><strong>Create.</strong></li><li>Repeat the process to create <code>dashboard-dev</code> and <code>dashboard-user</code> groups.</li></ol><p>Now map the group to a role:</p><ol><li>Select dashboard-admin from the list</li><li>Select the <strong>Role mapping</strong> tab.</li><li>Select <strong>Assign Role.</strong></li><li>Select <strong><code>dashboard-admin</code></strong></li><li><strong>Assign.</strong></li><li>Repeat the process for <code>dashboard-dev</code></li></ol><h4 id=add-the-group-client-scope>Add the group client scope</h4><ol><li>In the left hand menu, select <strong>Client scopes</strong> and <strong>Create client scope</strong>.</li><li>Name it <code>groups</code> and provide a description.</li><li><strong>Save</strong>.</li></ol><p>Now map the scope:</p><ol><li>Select the <strong>Mappers</strong> tab.</li><li><strong>Add predefined mappers.</strong></li><li>Select <code>groups</code>.</li><li><strong>Add</strong>.</li></ol><h4 id=add-new-client-scopes-to-dashboard-client>Add new client scopes to dashboard client</h4><ol><li>In the left hand menu, select <strong>Clients</strong>, and then <code>dashboard</code>.</li><li>Select the <strong>Client scopes</strong> tab.</li><li><strong>Add client scope</strong>.</li><li>Select <code>groups</code> and <code>libreClientScope</code>.</li><li><strong>Add Default</strong>.</li></ol><h3 id=add-client-policy>Add Client Policy</h3><p>In Keycloak, <em>policies</em> define authorization.
Rhize requires authorization for the database service.</p><ol><li>In the left hand menu, select <strong>Clients</strong>, and then <code>libreBaas</code>.</li><li>Select the <strong>Authorization</strong> tab.</li><li>Select <strong>Policies > Create Policy</strong></li><li>Select <strong>Group > Create Policy</strong>.</li><li>Name the policy <code>libreAdminGroupPolicy</code>.</li><li>Select <strong>Add Groups</strong>.</li><li>Select <code>libreAdminGroup</code>.</li><li><strong>Add</strong>.</li><li>For <strong>Logic</strong>, choose <code>Positive</code>.</li><li><strong>Save</strong>.</li></ol><h3 id=add-users>Add users</h3><ol><li>In the left hand menu, select <strong>Users</strong>, and <strong>Add User</strong>.</li><li>Fill in the following values:<ul><li><strong>Username</strong>: <code>system@libremfg.ai</code>.</li><li><strong>Email</strong>: <code>system@libremfg.ai</code>.</li><li><strong>Email Verified</strong>: <code>On</code></li><li><strong>First name</strong>: <code>system</code></li><li><strong>Last name</strong>: <code>Libre</code></li><li><strong>Join Groups</strong>: <code>libreAdminGroup</code></li></ul></li><li><strong>Create</strong>.</li></ol><p>Now create a user password:</p><ol><li>Select the <strong>Credentials</strong> tab.</li><li><strong>Set Password</strong>.</li><li>Enter a strong password.</li><li>For <strong>Temporary</strong>, choose <code>Off</code>.</li><li><strong>Save</strong>.</li></ol><p>Repeat this process for the following accounts:</p><ul><li>Audit:<ul><li><strong>Username</strong>: <code>libreAudit@libremfg.ai</code></li><li><strong>Email</strong>: <code>libreAudit@libremfg.ai</code></li><li><strong>Email Verified</strong>: <code>On</code></li><li><strong>First name</strong>: <code>Audit</code></li><li><strong>Last name</strong>: <code>Libre</code></li><li><strong>Join Groups</strong>: <code>libreAdminGroup</code></li></ul></li><li>Core:<ul><li><strong>Username</strong>: <code>libreCore@libremfg.ai</code></li><li><strong>Email</strong>: <code>libreCore@libremfg.ai</code></li><li><strong>Email Verified</strong>: <code>On</code></li><li><strong>First name</strong>: <code>Core</code></li><li><strong>Last name</strong>: <code>Libre</code></li><li><strong>Join Groups</strong>: <code>libreAdminGroup</code></li></ul></li><li>BPMN<ul><li><strong>Username</strong>: <code>libreBpmn@libremfg.ai</code></li><li><strong>Email</strong>: <code>libreBpmn@libremfg.ai</code></li><li><strong>Email Verified</strong>: <code>On</code></li><li><strong>First name</strong>: <code>Bpmn</code></li><li><strong>Last name</strong>: <code>Libre</code></li><li><strong>Join Groups</strong>: <code>libreAdminGroup</code></li></ul></li><li>Router<ul><li><strong>Username</strong>: <code>libreRouter@libremfg.ai</code></li><li><strong>Email</strong>: <code>libreRouter@libremfg.ai</code></li><li><strong>Email Verified</strong>: <code>On</code></li><li><strong>First name</strong>: <code>Router</code></li><li><strong>Last name</strong>: <code>Libre</code></li><li><strong>Join Groups</strong>: <code>libreAdminGroup</code></li></ul></li><li>Agent<ul><li><strong>Username</strong>: <code>libreAgent@libremfg.ai</code></li><li><strong>Email</strong>: <code>libreAgent@libremfg.ai</code></li><li><strong>Email Verified</strong>: <code>On</code></li><li><strong>First name</strong>: <code>Agent</code></li><li><strong>Last name</strong>: <code>Libre</code></li><li><strong>Join Groups</strong>: <code>libreAdminGroup</code></li></ul></li></ul><h2 id=enable-keycloak-audit-trail>Enable Keycloak Audit Trail</h2><p>With the <code>libre</code> realm selected:</p><ol><li>Select <strong>Realm Settings</strong>, and then <strong>Events</strong>.</li><li>Select the tab <strong>User event settings</strong>.</li><li>Enable <strong>Save Events</strong> and set an expiration.</li><li><strong>Save</strong>.</li><li>Repeat the process for the <strong>Admin event settings</strong> tab.</li></ol><h2 id=configure-password-policy>Configure password policy</h2><p>With the <code>libre</code> realm selected:</p><ol><li>Select <strong>Authentication</strong> and then the <strong>Policies</strong> tab.</li><li>Select the <strong>Password policy</strong> tab.</li><li>Add your organisation&rsquo;s password policy.</li></ol><h2 id=configure-brute-force-protections>Configure brute-force protections</h2><p>With the <code>libre</code> realm selected:</p><ol><li>Select <strong>Realm settings</strong> and then the <strong>Security defenses</strong> tab.</li><li>In <strong>Brute force detection</strong>, enable the feature and configure it to your requirements.</li></ol><h2 id=next-steps>Next steps</h2><p><a href=https://docs.rhize.com/deploy/install/services/>Install services</a>.</p></article><div class=right-toc><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#steps>Steps</a><ul><li><a href=#log-in>Log in</a></li><li><a href=#create-a-realm>Create a realm</a></li><li><a href=#create-clients>Create clients</a></li><li><a href=#scope-services>Scope services</a></li><li><a href=#create-roles-and-groups>Create roles and groups</a></li><li><a href=#add-client-policy>Add Client Policy</a></li><li><a href=#add-users>Add users</a></li></ul></li><li><a href=#enable-keycloak-audit-trail>Enable Keycloak Audit Trail</a></li><li><a href=#configure-password-policy>Configure password policy</a></li><li><a href=#configure-brute-force-protections>Configure brute-force protections</a></li><li><a href=#next-steps>Next steps</a></li></ul></nav></div></div></main><script type=text/javascript src=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js></script><script src=https://docs.rhize.com/js/clipboard.min.js></script><script src=https://docs.rhize.com/js/dgraph.js?a9873668f1334ff6c49d4edea0a4bc38></script><script>hljs.initHighlightingOnLoad()</script></body></html>