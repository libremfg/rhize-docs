<!doctype html><html lang=en class="js csstransforms3d"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-0PJKXDWQ4P"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0PJKXDWQ4P")}</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=referrer content="no-referrer-when-downgrade"><meta property="og:image" content="https://docs.rhize.com/images/rhize-logo.png"><meta property="og:image:secure_url" content="https://docs.rhize.com/images/rhize-logo.png"><meta property="og:description" content="Instructions to install services in the Rhize Kubernetes cluster."><meta property="og:type" content="website"><meta property="og:title" content="Install Rhize services"><meta property="og:site_name" content="Rhize documentation"><meta property="og:url" content="https://docs.rhize.com/deploy/install/services/"><meta property="og:locale" content="en"><meta name=generator content="Hugo 0.129.0"><meta name=description content="Instructions to install services in the Rhize Kubernetes cluster."><link rel=canonical href=https://docs.rhize.com/deploy/install/services/><link rel=apple-touch-icon sizes=57x57 href=https://docs.rhize.com/images/favicons/apple-touch-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=https://docs.rhize.com/images/favicons/apple-touch-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=https://docs.rhize.com/images/favicons/apple-touch-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=https://docs.rhize.com/images/favicons/apple-touch-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=https://docs.rhize.com/images/favicons/apple-touch-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=https://docs.rhize.com/images/favicons/apple-touch-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=https://docs.rhize.com/images/favicons/apple-touch-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=https://docs.rhize.com/images/favicons/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=https://docs.rhize.com/images/favicons/apple-touch-icon-180x180.png><link rel=icon type=image/png href=https://docs.rhize.com/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://docs.rhize.com/images/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=https://docs.rhize.com/images/favicons/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=https://docs.rhize.com/images/favicons/favicon-16x16.png sizes=16x16><link rel=manifest href=https://docs.rhize.com/images/favicons/manifest.webmanifest><link rel=mask-icon href=https://docs.rhize.com/images/favicons/safari-pinned-tab.svg color=#fe2c06><link rel="shortcut icon" href=https://docs.rhize.com/images/favicons/favicon.ico><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/default.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js></script><script async src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/languages/go.min.js></script><script async src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/languages/java.min.js integrity="sha256-RyOs5MjQ+Ef9DQrPHp4QGr2tcNjxLh6mCkkW+sS4doU=" crossorigin=anonymous></script><script src=//code.jquery.com/jquery-3.2.1.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><title>Install Rhize services
|
Deploy
</title><link href=https://docs.rhize.com/css/theme.css?07639695cdaf2b91d81cbbea8d450140 rel=stylesheet><link href=https://docs.rhize.com/css/runnable.css?46648956d99faa2e057d109b9f2a52e6 rel=stylesheet><link href=https://docs.rhize.com/css/tabs.css?035edc32762cb7973b740e3067101ced rel=stylesheet><link href=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css rel=stylesheet integrity=sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ crossorigin=anonymous><script src=//cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js integrity=sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js integrity=sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn crossorigin=anonymous></script><link href="//fonts.googleapis.com/css?family=Lato:400,700" rel=stylesheet><link href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css rel=stylesheet integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous><link href=https://cdn.lineicons.com/2.0/LineIcons.css rel=stylesheet crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3></head><body><nav id=header><div class=header-left><div><a href=https://docs.rhize.com/ class=brand><img src=https://docs.rhize.com//images/rhize-logo.png alt=RHIZE class=logo></a><div class=logo-tagline><span>Documentation</span></div></div></div><div class=header-right><div id=docsearch><div class="menu-search align-middle"><div id=docsearch></div></div></div><div><ul class=menu><li><a href=https://rhize.com target=_blank>Home</a></li><li><a href=https://forum.rhize.com target=_blank>Community</a></li><li><a href=https://www.youtube.com/@rhizemanufacturingdatahub target=_blank>Youtube</a></li></ul></div></div><a href=# id=sidebar-toggle><i class="fa fa-bars"></i></a></nav><aside id=sidebar><ul class=topics><li class="topic main-topic children"><a id=get-started href=#>Get started</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/get-started/introduction/>What is Rhize?</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/get-started/how-rhize-works/>How Rhize works</a></li></ul></li><li class="topic main-topic children active"><a id=deploy href=#>Deploy</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic active"><a href=#>Install</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/install/overview/>Overview</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/install/setup-kubernetes/>Set up Kubernetes</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/install/keycloak/>Configure Keycloak</a></li><li class="topic sub-topic active"><a href=https://docs.rhize.com/deploy/install/services/>Install Rhize services</a></li></ul></li><li class="topic sub-topic"><a href=#>Back up</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/backup/graphdb/>Back up the Graph DB</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/backup/audit/>Back up Audit PostgreSQL</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/backup/grafana/>Back up Grafana</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/backup/keycloak/>Back up Keycloak</a></li></ul></li><li class="topic sub-topic"><a href=#>Restore</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/restore/graphdb/>Restore the GraphDB</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/restore/audit/>Restore Audit backup</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/restore/grafana/>Restore Grafana</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/restore/keycloak/>Restore Keycloak</a></li></ul></li><li class="topic sub-topic"><a href=#>Maintain</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/maintain/audit/>Archive the PostgreSQL Audit trail</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/maintain/bpmn-nodes/>BPMN execution recovery</a></li></ul></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/upgrade/>Upgrade</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/about-openidconnect/>About OpenID connect</a></li></ul></li><li class="topic main-topic children"><a id=user-guides href=#>User guides</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=#>Use GraphQL</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/call-the-graphql-api/>Overview: the Rhize API</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/query/>Query</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/filter/>Filter</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/mutate/>Mutate</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/subscribe/>Subscribe</a></li></ul></li><li class="topic sub-topic"><a href=#>Write BPMN workflows</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/create-workflow/>Overview: orchestrate processes</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/trigger-workflows/>Trigger workflows</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/use-jsonata/>Use JSONata</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/debug-workflows/>Handle errors and debug</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/tune-performance/>Tune performance</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/variables/>Special variables</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/naming-conventions/>Naming conventions</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/learning-resources/>BPMN learning resources</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/bpmn-elements/>BMPN elements</a></li></ul></li><li class="topic sub-topic"><a href=#>Define production models</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/model/create-objects-ui/>Create objects from the UI</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/model/master-definitions/>Master definitions and fields</a></li></ul></li><li class="topic sub-topic"><a href=#>Connect event data</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/publish-subscribe/connect-datasource/>Connect data source</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/publish-subscribe/create-equipment-class-rule/>Tutorial: Trigger a workflow from a rule</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/publish-subscribe/track-changes/>Track changes (CDC)</a></li></ul></li><li class="topic sub-topic"><a href=#>Use work calendars</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/work-calendars/about-calendars-and-overrides/>About calendars and overrides</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/work-calendars/create-work-calendar/>Create work calendars</a></li></ul></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/audit/>Audit</a></li></ul></li><li class="topic main-topic children"><a id=use-cases href=#>Use cases</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/use-cases/overview/>Overview</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/use-cases/genealogy/>Genealogy</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/use-cases/ebr/>Electronic batch records</a></li></ul></li><li class="topic main-topic children"><a id=reference href=#>Reference</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=#>Service configuration</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/agent-configuration/>Agent configuration</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/audit-configuration/>Audit configuration</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/bpmn-configuration/>BPMN configuration</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/calendar-configuration/>Calendar Service configuration</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/core-configuration/>Core configuration</a></li></ul></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/default-ports/>Default URLs and local ports</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/gql-types/>GQL types and filters</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/glossary/>Glossary</a></li></ul></li><li class="topic main-topic children"><a id=explanations href=#>Explanations</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/explanations/manufacturing-data-hub/>Manufacturing Data Hub</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/explanations/isa-95-diagrams/>ISA-95 diagrams</a></li></ul></li><li class="topic main-topic children"><a id=releases href=#>Releases</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/3-0/>3.0.0</a></li><li class="topic sub-topic"><a href=#>Changelog</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0/>3.0.0 (general release)</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc09/>3.0.0rc09</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc08/>3.0.0rc08</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc07/>3.0.0rc07</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc06/>3.0.0rc06</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc05/>3.0.0rc05</a></li></ul></li></ul></li><li class="topic main-topic"><a href=https://docs.rhize.com/></a></li></ul></aside><script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script><script type=text/javascript>docsearch({appId:"70JLDGIDQA",apiKey:"2b4c57aa9d3d0386bf1a6df5b54eb3cf",indexName:"rhize",insights:!0,container:"#docsearch",debug:!1})</script></body></html><main class=content-wrapper><div class=content><div class=top-toc><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a><ul><li><a href=#overrides>Overrides</a></li></ul></li><li><a href=#get-client-secrets>Get client secrets.</a></li><li><a href=#add-the-rhize-helm-chart-repository>Add the Rhize Helm Chart Repository</a></li><li><a href=#db>Install and add roles for the DB</a></li><li><a href=#install-services>Install services</a><ul><li><a href=#nats>NATS</a></li><li><a href=#tempo>Tempo</a></li><li><a href=#core>Core</a></li><li><a href=#bpmn>BPMN</a></li><li><a href=#router>Router</a></li><li><a href=#grafana>Grafana</a></li><li><a href=#agent>Agent</a></li></ul></li><li><a href=#install-ui>Install UI</a></li><li><a href=#optional-audit-trail-service>Optional: Audit Trail service</a><ul><li><a href=#enable-change-data-dapture>Enable change data dapture</a></li><li><a href=#enable-audit-subgraph>Enable Audit subgraph</a></li></ul></li><li><a href=#optional-calendar-service>Optional: calendar service</a></li><li><a href=#optional-change-service-configuration>Optional: change service configuration</a></li><li><a href=#troubleshoot>Troubleshoot</a></li></ul></nav></div><article><a class=edit-btn target=_blank href=https://github.com/libremfg/libremfg.github.io/edit/main/content/deploy/install/services.md><i class="fa fa-github-alt"></i> Edit Page</a><h1 class=post-title>Install Rhize services</h1><p>The final installation step is to install the Rhize services in your Kubernetes cluster.</p><h2 id=prerequisites>Prerequisites</h2><p>This topic assumes you have done the following:</p><ul><li><p><a href=https://docs.rhize.com/deploy/install/setup-kubernetes>Set up Kubernetes</a> and <a href=https://docs.rhize.com/deploy/install/keycloak/>Configured Keycloak</a>. All the prerequisites for those topics apply here.</p></li><li><p>Configured load balancing for the following DNS records:</p><table><thead><tr><th>Service</th><th>Domain</th></tr></thead><tbody><tr><td>Admin UI</td><td><code>rhize-ui.&lt;YOUR_DOMAIN></code></td></tr><tr><td>Keycloak</td><td><code>rhize-auth.&lt;YOUR_DOMAIN></code></td></tr><tr><td>GraphQL</td><td><code>rhize-api.&lt;YOUR_DOMAIN></code></td></tr><tr><td>NATS</td><td><code>rhize-mqtt.&lt;YOUR_DOMAIN></code></td></tr><tr><td>Grafana</td><td><code>rhize-grafana.&lt;YOUR_DOMAIN></code></td></tr></tbody></table><p><em>Note that <code>rhize-</code> is only the recommended prefix of the subdomain. Your organization may use something else.</em></p></li></ul><h3 id=overrides>Overrides</h3><p>Each service is installed through a Helm YAML file.
For some of these services, you might need to edit this file to add credential information and modify defaults.</p><p>Common values that are changed include:</p><ul><li>URLs and URL links</li><li>The number of replicas running for each pod</li><li>Ingress values for services exposed on the internet</li></ul><h2 id=get-client-secrets>Get client secrets.</h2><ol><li><p>Go to Keycloak and get the secrets for each client you&rsquo;ve created.</p></li><li><p>Create Kubernetes secrets for each service. You can either create a secret file, or pass raw data from the command line.</p><div class="notices caution"><span class=type>Caution</span> How you create Kubernetes secrets <strong>depends on your implementation details and security procedures.</strong>
For guidance, refer to the official Kubernetes topic, <a href=https://kubernetes.io/docs/tasks/configmap-secret/managing-secret-using-kubectl/>Managing Secrets using <code>kubectl</code></a>.</div><p>With raw data, the command might look something like this.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create secret generic libre-client-secrets <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>-n libre --from-literal=dashboard=&lt;USER <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>--from-literal=libreAgent=123 <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>--from-literal=libreAudit=123 <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>--from-literal=libreBaas=KYbMHlRLhXwiDNFuDCl3qtPj1cNdeMSl <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>--from-literal=libreBPMN=123 <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>--from-literal=libreCore=123 <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>--from-literal=libreUI=123 <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>--from-literal=router=123
</span></span></code></pre></div><p>As you install services through Helm, their respective YAML files reference these secrets.</p></li></ol><h2 id=add-the-rhize-helm-chart-repository>Add the Rhize Helm Chart Repository</h2><p>You must add the helm chart repository for Rhize.</p><ol><li><p>Add the Helm Chart Repository</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add libre https://gitlab.com/api/v4/projects/42214456/packages/helm/stable
</span></span></code></pre></div></li></ol><h2 id=db>Install and add roles for the DB</h2><p>You must install the libreBaas database service first.
You also need to configure the libreBaas service to have roles in Keycloak.</p><p>If enabling the Audit Trail, also the include the configuration in <a href=#enable-change-data-capture>Enable change data capture</a>.</p><ol><li><p>Use Helm to install the database:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install -f baas.yaml libre-baas libre/baas -n libre
</span></span></code></pre></div><p>To confirm it works, run the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods
</span></span></code></pre></div><p>All statuses should be <code>RUNNING</code>.</p></li><li><p>Return to the Keycloak UI and add all <code>libre</code> roles to the admin group.</p></li><li><p>Proxy the <code>http:8080</code> port on <code>libre-baas-dgraph-alpha</code>.</p></li><li><p>Get a token using the credentials. With <code>curl</code>, it looks like this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl --location --request POST <span style=color:#a31515>&#39;https://&lt;customer&gt;-
</span></span></span><span style=display:flex><span><span style=color:#a31515>auth.libre/realms/libre/protocol/openid-connect/token&#39;</span> <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>--header <span style=color:#a31515>&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>--data-urlencode <span style=color:#a31515>&#39;grant_type=password&#39;</span> <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>--data-urlencode <span style=color:#a31515>&#39;username=system@libre.com&#39;</span> <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>--data-urlencode <span style=color:#a31515>&#39;password=&lt;PASSWORD&gt;&#39;</span> <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>--data-urlencode <span style=color:#a31515>&#39;client_id=libreBaas&#39;</span> <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>--data-urlencode <span style=color:#a31515>&#39;client_secret=&lt;CLIENT_SECRET&gt;&#39;</span>
</span></span></code></pre></div></li><li><p>Post the schema:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl --location --request POST <span style=color:#a31515>&#39;http://localhost:&lt;FORWARDED_PORT&gt;/admin/schema&#39;</span> <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>--header <span style=color:#a31515>&#39;Authorization: Bearer &lt;TOKEN&gt;&#39;</span> <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>--data grant_type=urn:ietf:params:oauth:grant-type:uma-ticket<span style=color:#a31515>&#34; \
</span></span></span><span style=display:flex><span><span style=color:#a31515>--header &#39;Content-Type: application/octet-stream&#39; \
</span></span></span><span style=display:flex><span><span style=color:#a31515>--data-binary &#39;&lt;SCHEMA_FILE&gt;’
</span></span></span></code></pre></div><p>This creates more roles.</p></li><li><p>Go to Keycloak UI and add all new libreBaas roles to the <code>ADMIN</code> group.</p></li></ol><p>If the install is successful, the Keycloak UI is available on its
<a href=https://docs.rhize.com/reference/default-ports/>default port</a>.</p><h2 id=install-services>Install services</h2><p>Each of the following procedures installs a service through Helm.</p><p>The syntax to install a Rhize service must have arguments for the following:</p><ul><li>The chart YAML file</li><li>The packaged chart</li><li>The path to the unpackaged chart or directory</li></ul><p>Additionally, use the <code>-n</code> flag to ensure that the install is scoped to the correct namespace:</p><pre tabindex=0><code>helm install &lt;service_name&gt; \
  -f &lt;service-overide-file&gt;.yaml \
  &lt;path/to/directory&gt; \
  -n &lt;ns&gt;
</code></pre><p>For the full configuration options,
read the official <a href=https://helm.sh/docs/helm/helm_install/>Helm <code>install</code> reference</a>.</p><h3 id=nats>NATS</h3><p><a href=https://nats.io>NATS</a> is the message broker that powers Rhize&rsquo;s event-driven architecture.</p><p>Install NATS with these steps:</p><ol><li><p>Modify the NATS Helm file with your code editor. Edit any necessary overrides.</p></li><li><p>Install with Helm:</p><pre tabindex=0><code>helm install nats -f nats.yaml libre/nats -n libre
</code></pre></li></ol><h3 id=tempo>Tempo</h3><p>Rhize uses <a href=https://grafana.com/oss/tempo/>Tempo</a> to trace BPMN processes.</p><p>Install Tempo with these steps:</p><ol><li><p>If it doesn&rsquo;t exist, add the Tempo repository:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add grafana https://grafana.github.io/helm-charts
</span></span></code></pre></div></li><li><p>Modify the Helm file as needed.</p></li><li><p>Install with Helm:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install tempo -f tempo.yaml grafana/tempo -n libre
</span></span></code></pre></div></li></ol><h3 id=core>Core</h3><p>The Libre Core service is the custom edge agent that monitors data sources, like OPC-UA servers, and publishes and subscribes topics to NATS.</p><blockquote><p><strong>Requirements</strong>: Core requires the <a href=#db>libreBaas</a> and <a href=#nats>NATS</a> services.</p></blockquote><p>Install the Core agent with these steps:</p><ol><li><p>In the <code>core.yaml</code> Helm file, edit the <code>clientSecret</code> and <code>password</code> with settings from the Keycloak client.</p></li><li><p>Override any other values, as needed.</p></li><li><p>Install with Helm:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install core -f core.yaml libre/core -n libre
</span></span></code></pre></div></li></ol><h3 id=bpmn>BPMN</h3><p>The BPMN service is the custom engine Rhize uses to process low-code workflows modeled in the BPMN UI.</p><blockquote><p><strong>Requirements</strong>: The BPMN service requires the <a href=#db>libreBaas</a>, <a href=#nats>NATS</a>, and <a href=#tempo>Tempo</a> services.</p></blockquote><p>Install the BPMN engine with these steps:</p><ol><li><p>Open <code>bpmn.yaml</code> Update the <code>clientSecret</code> and <code>password</code> for your BPMN Keycloak credentials.</p></li><li><p>Modify any other values, as needed.</p></li><li><p>Install with Helm:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install bpmn -f bpmn.yaml libre/bpmn -n libre
</span></span></code></pre></div></li></ol><h3 id=router>Router</h3><p>Rhize uses the <a href=https://www.apollographql.com/docs/router>Apollo router</a> to unite queries for different services in a single endpoint.</p><blockquote><p><strong>Requirements:</strong> Router requires the <a href=#db>GraphDB</a>, <a href=#bpmn>BPMN</a>, and <a href=#core>Core</a> services.</p></blockquote><p>Install the router with these steps:</p><ol><li><p>Modify the router Helm YAML file as needed.</p></li><li><p>Install with Helm:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install router -f router.yaml libre/router -n libre
</span></span></code></pre></div></li></ol><p>If the install is successful, the Router explorer is available on its
<a href=https://docs.rhize.com/reference/default-ports/>default port</a>.</p><h3 id=grafana>Grafana</h3><p>Rhize uses <a href=https://grafana.com>Grafana</a> for its dashboard to monitor real time data.</p><p>Install Grafana with these steps:</p><ol><li><p>Modify the Grafana Helm YAML file as needed.</p></li><li><p>Add the Helm repository</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add grafana https://grafana.github.io/helm-charts
</span></span></code></pre></div></li><li><p>Install with Helm:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install grafana -f grafana.yaml grafana/grafana -n libre
</span></span></code></pre></div></li></ol><p>If the install is successful, the Grafana service is available on its
<a href=https://docs.rhize.com/reference/default-ports/>default port</a>.</p><h3 id=agent>Agent</h3><p>The Rhize agent bridges your plant processes with the Rhize data hub.
It collects data emitted from the plant and publishes it to the NATS message broker.</p><blockquote><p><strong>Requirements:</strong> Agent requires the <a href=#db>Graph DB</a>, <a href=#nats>Nats</a>, and <a href=#tempo>Tempo</a> services.</p></blockquote><p>Install the agent with these steps:</p><ol><li><p>Modify the Agent Helm file as needed.</p></li><li><p>Install with Helm:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install agent -f agent.yaml libre/agent -n libre
</span></span></code></pre></div></li></ol><h2 id=install-ui>Install UI</h2><p>The UI is the graphical frontend to <a href=https://docs.rhize.com/how-to/bpmn/>handle events</a> and <a href=https://docs.rhize.com/how-to/model/>define work masters</a>.</p><blockquote><p><strong>Requirements:</strong> The UI requires the <a href=#db>GraphDB</a>, <a href=#bpmn>BPMN</a>, <a href=#core>Core</a>, and <a href=#router>Router</a> services.</p></blockquote><p>After installing all other services, install the UI with these steps:</p><ol><li><p>Forward the port from the Router API.</p></li><li><p>Open the UI Helm file. Update the <code>envVars</code> object with settings from the UI Keycloak client.</p></li><li><p>Modify any other values, as needed.</p></li><li><p>Install with Helm:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install ui -f ui-overrides.yaml libre/admin-ui -n libre
</span></span></code></pre></div></li></ol><p>If the install is successful, the UI is available on its
<a href=https://docs.rhize.com/reference/default-ports/>default port</a>.</p><h2 id=optional-audit-trail-service>Optional: Audit Trail service</h2><p>The Rhize <a href=https://docs.rhize.com/how-to/audit/>Audit</a> service provides an audit trail for database changes to install. The Audit service uses PostgreSQL for storage.</p><p>Install Audit Service with these steps:</p><ol><li><p>Modify the Audit trail Helm YAML file. It is <em>recommended</em> to change the PostgreSQL username and password values.</p></li><li><p>Install with Helm:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install audit -f audit.yaml libre/audit -n libre
</span></span></code></pre></div></li></ol><h3 id=enable-change-data-dapture>Enable change data dapture</h3><p>The Audit trail requires <a href=https://docs.rhize.com/how-to/publish-subscribe/track-changes/>change data capture (CDC)</a> to function. To enable CDC in libre BAAS, include the following values for the Helm chart overrides:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>alpha:
</span></span><span style=display:flex><span>  <span style=color:green># Change Data Capture (CDC)</span>
</span></span><span style=display:flex><span>  cdc:
</span></span><span style=display:flex><span>    <span style=color:green># Enable</span>
</span></span><span style=display:flex><span>    enabled: <span style=color:#00f>true</span>
</span></span><span style=display:flex><span>    <span style=color:green># If configured for security, configure in NATS url. For example `nats://username:password@nats:4222`</span>
</span></span><span style=display:flex><span>    nats: nats://nats:4222
</span></span><span style=display:flex><span>    <span style=color:green># Adjust based on high-availability requirements and cluster size.</span>
</span></span><span style=display:flex><span>    replicas: 1
</span></span></code></pre></div><h3 id=enable-audit-subgraph>Enable Audit subgraph</h3><p>To use the Audit trail in the UI, you must add the Audit trail subgraph into the router. To enable router to use and compose the subgraph:</p><ol><li>Update the Router Helm chart overrides, <code>router.yaml</code>, to include:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green># Add Audit to the router subgraph url override</span>
</span></span><span style=display:flex><span>router:
</span></span><span style=display:flex><span>  configuration:
</span></span><span style=display:flex><span>    override_subgraph_url:
</span></span><span style=display:flex><span>      AUDIT: http://audit:8084/query
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green># If supergraph compose is enabled</span>
</span></span><span style=display:flex><span>supergraphCompose:
</span></span><span style=display:flex><span>  supergraphConfig:
</span></span><span style=display:flex><span>    subgraphs:
</span></span><span style=display:flex><span>    AUDIT:
</span></span><span style=display:flex><span>      routing_url: http://audit:8084/query
</span></span><span style=display:flex><span>      schema:
</span></span><span style=display:flex><span>        subgraph_url: http://audit:8084/query
</span></span></code></pre></div><ol start=2><li>Update the Router deployment</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ helm upgrade --install router -f router.yaml libre/router -n libre
</span></span></code></pre></div><h2 id=optional-calendar-service>Optional: calendar service</h2><p>The <a href=https://docs.rhize.com/how-to/work-calendars/>Libre calendar service</a> monitors work calendar definitions and creates work calendar entries in real time, both in the <a href=#db>Graph</a> and time-series databases.</p><blockquote><p><strong>Requirements:</strong> The calendar service requires the <a href=#db>GraphDB</a>, <a href=#keycloak>Keycloak</a>, and <a href=#nats>NATS</a> services.</p></blockquote><div class="notices note"><span class=type>Note</span> The work calendar requires a time-series DB installed such as <a href=https://influxdata.com/>InfluxDB</a>, <a href=https://questdb.io>QuestDB</a> or <a href=https://www.timescale.com/>TimescaleDB</a>. The following instructions are specific to QuestDB.</div><p>Install the calendar service with these steps:</p><ol><li><p>Create tables in the time series. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#00f>CREATE</span> <span style=color:#00f>TABLE</span> <span style=color:#00f>IF</span> <span style=color:#00f>NOT</span> <span style=color:#00f>EXISTS</span> PSDT_POT(
</span></span><span style=display:flex><span>  EquipmentId SYMBOL,
</span></span><span style=display:flex><span>  EquipmentVersion STRING,
</span></span><span style=display:flex><span>  WorkCalendarId STRING,
</span></span><span style=display:flex><span>  WorkCalendarIid STRING,
</span></span><span style=display:flex><span>  WorkCalendarDefinitionId STRING,
</span></span><span style=display:flex><span>  WorkCalendarDefinitionEntryId STRING,
</span></span><span style=display:flex><span>  WorkCalendarDefinitionEntryIid STRING,
</span></span><span style=display:flex><span>  WorkCalendarEntryId STRING,
</span></span><span style=display:flex><span>  WorkCalendarEntryIid SYMBOL,
</span></span><span style=display:flex><span>  HierarchyScopeId STRING,
</span></span><span style=display:flex><span>  EntryType STRING,
</span></span><span style=display:flex><span>  ISO22400CalendarState STRING,
</span></span><span style=display:flex><span>  isDeleted boolean,
</span></span><span style=display:flex><span>  updatedAt <span style=color:#00f>TIMESTAMP</span>,
</span></span><span style=display:flex><span>  time <span style=color:#00f>TIMESTAMP</span>,
</span></span><span style=display:flex><span>  lockerCount INT,
</span></span><span style=display:flex><span>  lockers STRING
</span></span><span style=display:flex><span>) <span style=color:#00f>TIMESTAMP</span>(time) PARTITION <span style=color:#00f>BY</span> <span style=color:#00f>month</span>
</span></span><span style=display:flex><span>DEDUP UPSERT KEYS(time, EquipmentId, WorkCalendarEntryIid);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00f>CREATE</span> <span style=color:#00f>TABLE</span> <span style=color:#00f>IF</span> <span style=color:#00f>NOT</span> <span style=color:#00f>EXISTS</span> PDOT_PBT(
</span></span><span style=display:flex><span>  EquipmentId SYMBOL,
</span></span><span style=display:flex><span>  EquipmentVersion STRING,
</span></span><span style=display:flex><span>  WorkCalendarId STRING,
</span></span><span style=display:flex><span>  WorkCalendarIid STRING,
</span></span><span style=display:flex><span>  WorkCalendarDefinitionId STRING,
</span></span><span style=display:flex><span>  WorkCalendarDefinitionEntryId STRING,
</span></span><span style=display:flex><span>  WorkCalendarDefinitionEntryIid STRING,
</span></span><span style=display:flex><span>  WorkCalendarEntryId STRING,
</span></span><span style=display:flex><span>  WorkCalendarEntryIid SYMBOL,
</span></span><span style=display:flex><span>  HierarchyScopeId STRING,
</span></span><span style=display:flex><span>  EntryType STRING,
</span></span><span style=display:flex><span>  ISO22400CalendarState STRING,
</span></span><span style=display:flex><span>  isDeleted boolean,
</span></span><span style=display:flex><span>  updatedAt <span style=color:#00f>TIMESTAMP</span>,
</span></span><span style=display:flex><span>  time <span style=color:#00f>TIMESTAMP</span>,
</span></span><span style=display:flex><span>  lockerCount INT,
</span></span><span style=display:flex><span>  lockers STRING
</span></span><span style=display:flex><span>) <span style=color:#00f>TIMESTAMP</span>(time) PARTITION <span style=color:#00f>BY</span> <span style=color:#00f>month</span>
</span></span><span style=display:flex><span>DEDUP UPSERT KEYS(time, EquipmentId, WorkCalendarEntryIid);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00f>CREATE</span> <span style=color:#00f>TABLE</span> <span style=color:#00f>IF</span> <span style=color:#00f>NOT</span> <span style=color:#00f>EXISTS</span> Calendar_AdHoc(
</span></span><span style=display:flex><span>  EquipmentId SYMBOL,
</span></span><span style=display:flex><span>  EquipmentVersion STRING,
</span></span><span style=display:flex><span>  WorkCalendarId STRING,
</span></span><span style=display:flex><span>  WorkCalendarIid STRING,
</span></span><span style=display:flex><span>  WorkCalendarDefinitionId STRING,
</span></span><span style=display:flex><span>  WorkCalendarDefinitionEntryId STRING,
</span></span><span style=display:flex><span>  WorkCalendarDefinitionEntryIid STRING,
</span></span><span style=display:flex><span>  WorkCalendarEntryId STRING,
</span></span><span style=display:flex><span>  WorkCalendarEntryIid SYMBOL,
</span></span><span style=display:flex><span>  HierarchyScopeId STRING,
</span></span><span style=display:flex><span>  EntryType STRING,
</span></span><span style=display:flex><span>  ISO22400CalendarState STRING,
</span></span><span style=display:flex><span>  isDeleted boolean,
</span></span><span style=display:flex><span>  updatedAt <span style=color:#00f>TIMESTAMP</span>,
</span></span><span style=display:flex><span>  time <span style=color:#00f>TIMESTAMP</span>,
</span></span><span style=display:flex><span>  lockerCount INT,
</span></span><span style=display:flex><span>  lockers STRING
</span></span><span style=display:flex><span>) <span style=color:#00f>TIMESTAMP</span>(time) PARTITION <span style=color:#00f>BY</span> <span style=color:#00f>month</span>
</span></span><span style=display:flex><span>DEDUP UPSERT KEYS(time, EquipmentId, WorkCalendarEntryIid);
</span></span></code></pre></div></li><li><p>Modify the calendar YAML file as needed.</p></li><li><p>Deploy with helm</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install calendar-service -f calendar-service.yaml libre/calendar-service -n libre
</span></span></code></pre></div></li></ol><h2 id=optional-change-service-configuration>Optional: change service configuration</h2><p>The services installed in the previous step have many parameters that you can configure for your performance and deployment requirements.
Review the full list in the <a href=https://docs.rhize.com/reference/service-config/>Service configuration</a> reference.</p><h2 id=troubleshoot>Troubleshoot</h2><p>For general Kubernetes issues, the <a href=https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/>Kubernetes dashboard</a> is great for troubleshooting, and you can configure it to be accessible through the browser.</p><p>For particular problems, try these commands:</p><ul><li><p><strong>Is my service running?</strong></p><p>To check deployment status, use this command:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> kubectl get deployments
</span></span></code></pre></div><p>Look for the pod name and its status.</p></li><li><p><strong>Access service through browser</strong></p><p>Some services are accessible through the browser.
To access them, visit local host on the service&rsquo;s <a href=https://docs.rhize.com/reference/default-ports/>default port</a>.</p></li><li><p><strong>I installed a service too early</strong>.
If you installed a service too early, use Helm to uninstall:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm uninstall libreBaas
</span></span></code></pre></div><p>Then perform the steps you need and reinstall when ready.</p></li></ul></article><div class=right-toc><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a><ul><li><a href=#overrides>Overrides</a></li></ul></li><li><a href=#get-client-secrets>Get client secrets.</a></li><li><a href=#add-the-rhize-helm-chart-repository>Add the Rhize Helm Chart Repository</a></li><li><a href=#db>Install and add roles for the DB</a></li><li><a href=#install-services>Install services</a><ul><li><a href=#nats>NATS</a></li><li><a href=#tempo>Tempo</a></li><li><a href=#core>Core</a></li><li><a href=#bpmn>BPMN</a></li><li><a href=#router>Router</a></li><li><a href=#grafana>Grafana</a></li><li><a href=#agent>Agent</a></li></ul></li><li><a href=#install-ui>Install UI</a></li><li><a href=#optional-audit-trail-service>Optional: Audit Trail service</a><ul><li><a href=#enable-change-data-dapture>Enable change data dapture</a></li><li><a href=#enable-audit-subgraph>Enable Audit subgraph</a></li></ul></li><li><a href=#optional-calendar-service>Optional: calendar service</a></li><li><a href=#optional-change-service-configuration>Optional: change service configuration</a></li><li><a href=#troubleshoot>Troubleshoot</a></li></ul></nav></div></div></main><script type=text/javascript src=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js></script><script src=https://docs.rhize.com/js/clipboard.min.js></script><script src=https://docs.rhize.com/js/dgraph.js?a9873668f1334ff6c49d4edea0a4bc38></script><script>hljs.initHighlightingOnLoad()</script></body></html>