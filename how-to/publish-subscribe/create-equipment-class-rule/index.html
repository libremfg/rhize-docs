<!doctype html><html lang=en class="js csstransforms3d"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-0PJKXDWQ4P"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0PJKXDWQ4P")}</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=referrer content="no-referrer-when-downgrade"><meta property="og:image" content="https://docs.rhize.com/images/rhize-logo.png"><meta property="og:image:secure_url" content="https://docs.rhize.com/images/rhize-logo.png"><meta property="og:description" content="Follow this tutorial to create a rule to run a workflow every time a data source changes."><meta property="og:type" content="website"><meta property="og:title" content="Tutorial: Trigger a workflow from a rule"><meta property="og:site_name" content="Rhize documentation"><meta property="og:url" content="https://docs.rhize.com/how-to/publish-subscribe/create-equipment-class-rule/"><meta property="og:locale" content="en"><meta name=generator content="Hugo 0.132.0"><meta name=description content="Follow this tutorial to create a rule to run a workflow every time a data source changes."><link rel=canonical href=https://docs.rhize.com/how-to/publish-subscribe/create-equipment-class-rule/><link rel=apple-touch-icon sizes=57x57 href=https://docs.rhize.com/images/favicons/apple-touch-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=https://docs.rhize.com/images/favicons/apple-touch-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=https://docs.rhize.com/images/favicons/apple-touch-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=https://docs.rhize.com/images/favicons/apple-touch-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=https://docs.rhize.com/images/favicons/apple-touch-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=https://docs.rhize.com/images/favicons/apple-touch-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=https://docs.rhize.com/images/favicons/apple-touch-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=https://docs.rhize.com/images/favicons/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=https://docs.rhize.com/images/favicons/apple-touch-icon-180x180.png><link rel=icon type=image/png href=https://docs.rhize.com/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://docs.rhize.com/images/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=https://docs.rhize.com/images/favicons/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=https://docs.rhize.com/images/favicons/favicon-16x16.png sizes=16x16><link rel=manifest href=https://docs.rhize.com/images/favicons/manifest.webmanifest><link rel=mask-icon href=https://docs.rhize.com/images/favicons/safari-pinned-tab.svg color=#fe2c06><link rel="shortcut icon" href=https://docs.rhize.com/images/favicons/favicon.ico><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/default.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js></script><script async src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/languages/go.min.js></script><script async src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/languages/java.min.js integrity="sha256-RyOs5MjQ+Ef9DQrPHp4QGr2tcNjxLh6mCkkW+sS4doU=" crossorigin=anonymous></script><script src=//code.jquery.com/jquery-3.2.1.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><title>Tutorial: Trigger a workflow from a rule
|
How to
</title><link href=https://docs.rhize.com/css/theme.css?07639695cdaf2b91d81cbbea8d450140 rel=stylesheet><link href=https://docs.rhize.com/css/runnable.css?46648956d99faa2e057d109b9f2a52e6 rel=stylesheet><link href=https://docs.rhize.com/css/tabs.css?035edc32762cb7973b740e3067101ced rel=stylesheet><link href=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css rel=stylesheet integrity=sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ crossorigin=anonymous><script src=//cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js integrity=sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js integrity=sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn crossorigin=anonymous></script><link href="//fonts.googleapis.com/css?family=Lato:400,700" rel=stylesheet><link href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css rel=stylesheet integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous><link href=https://cdn.lineicons.com/2.0/LineIcons.css rel=stylesheet crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3></head><body><nav id=header><div class=header-left><div><a href=https://docs.rhize.com/ class=brand><img src=https://docs.rhize.com//images/rhize-logo.png alt=RHIZE class=logo></a><div class=logo-tagline><span>Documentation</span></div></div></div><div class=header-right><div id=docsearch><div class="menu-search align-middle"><div id=docsearch></div></div></div><div><ul class=menu><li><a href=https://rhize.com target=_blank>Home</a></li><li><a href=https://forum.rhize.com target=_blank>Community</a></li><li><a href=https://www.youtube.com/@rhizemanufacturingdatahub target=_blank>Youtube</a></li></ul></div></div><a href=# id=sidebar-toggle><i class="fa fa-bars"></i></a></nav><aside id=sidebar><ul class=topics><li class="topic main-topic children"><a id=get-started href=#>Get started</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/get-started/introduction/>What is Rhize?</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/get-started/how-rhize-works/>How Rhize works</a></li></ul></li><li class="topic main-topic children"><a id=deploy href=#>Deploy</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=#>Install</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/install/overview/>Overview</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/install/setup-kubernetes/>Set up Kubernetes</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/install/keycloak/>Configure Keycloak</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/install/services/>Install Rhize services</a></li></ul></li><li class="topic sub-topic"><a href=#>Back up</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/backup/graphdb/>Back up the Graph DB</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/backup/audit/>Back up Audit PostgreSQL</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/backup/grafana/>Back up Grafana</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/backup/keycloak/>Back up Keycloak</a></li></ul></li><li class="topic sub-topic"><a href=#>Restore</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/restore/graphdb/>Restore the GraphDB</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/restore/audit/>Restore Audit backup</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/restore/grafana/>Restore Grafana</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/restore/keycloak/>Restore Keycloak</a></li></ul></li><li class="topic sub-topic"><a href=#>Maintain</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/maintain/audit/>Archive the PostgreSQL Audit trail</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/maintain/bpmn-nodes/>BPMN execution recovery</a></li></ul></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/upgrade/>Upgrade</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/about-openidconnect/>About OpenID connect</a></li></ul></li><li class="topic main-topic children active"><a id=user-guides href=#>User guides</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=#>Use GraphQL</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/call-the-graphql-api/>Overview: the Rhize API</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/query/>Query</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/filter/>Filter</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/mutate/>Mutate</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/subscribe/>Subscribe</a></li></ul></li><li class="topic sub-topic"><a href=#>Write BPMN workflows</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/create-workflow/>Overview: orchestrate processes</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/trigger-workflows/>Trigger workflows</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/use-jsonata/>Use JSONata</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/debug-workflows/>Handle errors and debug</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/tune-performance/>Tune performance</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/variables/>Special variables</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/naming-conventions/>Naming conventions</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/learning-resources/>BPMN learning resources</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/bpmn-elements/>BMPN elements</a></li></ul></li><li class="topic sub-topic"><a href=#>Define production models</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/model/create-objects-ui/>Create objects from the UI</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/model/master-definitions/>Master definitions and fields</a></li></ul></li><li class="topic sub-topic active"><a href=#>Connect event data</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/publish-subscribe/connect-datasource/>Connect data source</a></li><li class="topic sub-topic active"><a href=https://docs.rhize.com/how-to/publish-subscribe/create-equipment-class-rule/>Tutorial: Trigger a workflow from a rule</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/publish-subscribe/track-changes/>Track changes (CDC)</a></li></ul></li><li class="topic sub-topic"><a href=#>Use work calendars</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/work-calendars/about-calendars-and-overrides/>About calendars and overrides</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/work-calendars/create-work-calendar/>Create work calendars</a></li></ul></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/audit/>Audit</a></li></ul></li><li class="topic main-topic children"><a id=use-cases href=#>Use cases</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/use-cases/overview/>Overview</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/use-cases/genealogy/>Genealogy</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/use-cases/ebr/>Electronic batch records</a></li></ul></li><li class="topic main-topic children"><a id=reference href=#>Reference</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=#>Service configuration</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/agent-configuration/>Agent configuration</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/audit-configuration/>Audit configuration</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/bpmn-configuration/>BPMN configuration</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/calendar-configuration/>Calendar configuration</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/core-configuration/>Core configuration</a></li></ul></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/default-ports/>Default URLs and local ports</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/gql-types/>GQL types and filters</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/glossary/>Glossary</a></li></ul></li><li class="topic main-topic children"><a id=explanations href=#>Explanations</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/explanations/manufacturing-data-hub/>Manufacturing Data Hub</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/explanations/isa-95-diagrams/>ISA-95 diagrams</a></li></ul></li><li class="topic main-topic children"><a id=releases href=#>Releases</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/3-0-1/>3.0.1</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/3-0/>3.0.0</a></li><li class="topic sub-topic"><a href=#>Changelog</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0/>3.0.0 (general release)</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc09/>3.0.0rc09</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc08/>3.0.0rc08</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc07/>3.0.0rc07</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc06/>3.0.0rc06</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc05/>3.0.0rc05</a></li></ul></li></ul></li><li class="topic main-topic"><a href=https://docs.rhize.com/></a></li></ul></aside><script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script><script type=text/javascript>docsearch({appId:"70JLDGIDQA",apiKey:"2b4c57aa9d3d0386bf1a6df5b54eb3cf",indexName:"rhize",insights:!0,container:"#docsearch",debug:!1})</script></body></html><main class=content-wrapper><div class=content><div class=top-toc><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#set-up-configure-equipment-and-workflows>Set up: configure equipment and workflows</a><ul><li><a href=#create-a-data-source>Create a data source</a></li><li><a href=#create-a-data-source-topic>Create a data source topic</a></li><li><a href=#create-a-unit-of-measure>Create a unit of measure</a></li><li><a href=#creating-a-bpmn-workflow>Creating a BPMN workflow</a></li><li><a href=#create-an-equipment-class-with-bound-properties>Create an equipment class with bound properties</a></li></ul></li><li><a href=#create-a-rule>Create a rule</a><ul><li><a href=#add-a-rule-to-an-existing-equipment-class>Add a rule to an existing equipment class</a></li><li><a href=#associate-an-equipment-with-a-bound-property>Associate an equipment with a bound property</a></li></ul></li><li><a href=#test-the-binding-and-the-rule>Test the binding and the rule</a><ul><li><a href=#test-using-an-mqtt-client>Test using an MQTT client</a></li><li><a href=#confirm-in-execution-in-tempo>Confirm in execution in Tempo</a></li></ul></li><li><a href=#video-example>Video example</a></li></ul></nav></div><article><a class=edit-btn target=_blank href=https://github.com/libremfg/libremfg.github.io/edit/main/content/how-to/publish-subscribe/create-equipment-class-rule.md><i class="fa fa-github-alt"></i> Edit Page</a><h1 class=post-title>Tutorial: Trigger a workflow from a rule</h1><p>An equipment class rule <a href=https://docs.rhize.com/how-to/bpmn/trigger-workflows/>triggers a BPMN</a> workflow whenever a data source publishes a value that meets a specified threshold.</p><p>Imagine a scenario when an oven must be preheated every time a new order number is published to an MQTT edge device.
You could automate this workflow with a rule that listens to messages published and evaluates a condition.
If the condition evaluates to <code>true</code>, the rule triggers a <abbr title="Business Process Model and Notation. A standardized graphical notation used to represent business processes in an intuitive, visual way. Rhize's BPMN UI and engine provides a low-code interface for complex event handling">BPMN</abbr> workflow to preheat the oven.</p><pre class=mermaid>---
title: Rules trigger workflows from data-source changes
---
flowchart LR
    A(Property\nchanged?) -->|yes| B{"rule evaluates\nto true?"}
    B -->|no| C(do nothing)
    B -->|"yes\n(optional: pass variables)"| D(Run BPMN workflow)
</pre><p>The broad procedure to create a rule is as follows:</p><ol><li>In the Rhize UI or through GraphQL, create models for the data source and its associated unit of measure, equipment, and equipment class.</li><li>In the Rhize UI, write a BPMN workflow that is triggered when this data source changes and executes some business logic.</li><li>In the equipment class, create a rule that triggers the workflow.</li></ol><p>The following sections describe how to do these steps in more detail.</p><div class="notices note"><span class=type>Note</span> This tutorial assumes a data source that exchanges messages over the MQTT protocol.</div><h2 id=prerequisites>Prerequisites</h2><p>Before you start, ensure you have the following:</p><ul><li>Access your Rhize customer environment</li><li>The <a href=https://docs.rhize.com/reference/service-config/agent-configuration/>Agent configured</a> to listen for your data-source ID</li></ul><h2 id=set-up-configure-equipment-and-workflows>Set up: configure equipment and workflows</h2><p>The setup involves modeling the objects associated with the rule.</p><ul><li>Data source</li><li>Data source topic</li><li>Unit of measure</li><li>BPMN</li><li>Equipment class with bound properties</li></ul><p>Once you have these, you can create a rule and associate it with an actual equipment item.</p><h3 id=create-a-data-source>Create a data source</h3><ol><li>From the main menu, navigate to <strong>Master Data > Data Sources</strong>.</li><li>Create a new data source. The label (ID) must match the one specified in the configuration file for the <code>libre-agent</code> microservice.</li><li>From the <strong>General</strong> tab, add a draft data source version.</li><li>Select <code>MQTT</code> as the data-source protocol.</li><li>Optionally, enter a connection string, such as <code>mqtt://&lt;REMOTE_HOST>:1883</code>, that matches the one specified in the configuration file for the <code>libre-agent</code> microservice.</li><li>Save the data source version to create it.</li></ol><figure class=big-figure><a href=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Creating_a_Data_Source_and_Version.png target=_blank><img src=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Creating_a_Data_Source_and_Version.png alt="A new data source and version created in the UI." width=100%></a><figcaption class=caption>A new data source and version created in the UI.</figcaption></figure><h3 id=create-a-data-source-topic>Create a data source topic</h3><ol><li>Navigate to the <strong>Topics</strong> tab.</li><li>Add a new property (that is, a topic).</li><li>Select <code>STRING</code> for the property data type (this assumes an order number is a string such as <code>Order1</code>).</li><li>Select your preferred deduplication key. The default option, <code>Message Value</code>, is most appropriate for this scenario.</li><li>For label, enter the exact topic name as it appears in the data source. Use a slash to access nested topics. For this example, all new order numbers are published to <code>Oven/OrderNumber</code>.</li><li>Confirm by clicking the green tick icon.</li><li>Navigate to the <strong>General</strong> tab and change the version state to active.</li></ol><figure class=big-figure><a href=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Creating_a_Data_Source_Topic.png target=_blank><img src=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Creating_a_Data_Source_Topic.png alt="A new data source topic created in the UI." width=100%></a><figcaption class=caption>A new data source topic created in the UI.</figcaption></figure><h3 id=create-a-unit-of-measure>Create a unit of measure</h3><ol><li>From the Main Menu, navigate to <strong>Master Data > Units of Measure</strong>.</li><li>Add a new unit of measure.</li><li>Enter <code>Order Number</code> for the unit name.</li><li>Select <code>STRING</code> for the data type.</li></ol><figure class=big-figure><a href=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Creating_a_Unit_of_Measure.png target=_blank><img src=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Creating_a_Unit_of_Measure.png alt="A new unit of measure created in the UI." width=100%></a><figcaption class=caption>A new unit of measure created in the UI.</figcaption></figure><h3 id=creating-a-bpmn-workflow>Creating a BPMN workflow</h3><p>A rule must trigger a BPMN workflow.
Before setting up a rule, create its workflow.
For this example, this 3-node BPMN is enough:</p><ol><li>Navigate to <strong>Workflows > Process List</strong>.</li><li>Import the BPMN.</li><li>Save it.</li><li>Set the version as active.</li></ol><figure class=big-figure><a href=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Creating_a_BPMN.png target=_blank><img src=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Creating_a_BPMN.png alt="A BPMN created in the UI." width=100%></a><figcaption class=caption>A BPMN created in the UI.</figcaption></figure><p>The BPMN has a <code>Libre Jsonata Transform</code> task that contains an expression <code>"Preheating oven for order number " & $.orderNumber"</code> .
The rule engine triggers this BPMN with a payload that includes the order number value, as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;orderNumber&#34;: <span style=color:#a31515>&#34;Order1&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=create-an-equipment-class-with-bound-properties>Create an equipment class with bound properties</h3><h4 id=equipment-class-and-version>Equipment class and version</h4><ol><li>Navigate to <strong>Master Data > Equipment Class</strong>.</li><li>Create a new equipment class from the sidebar. The label might be <code>Pizza Line</code>, for example.</li><li>From the <strong>General</strong> tab, <strong>Create</strong> a new Draft version.</li></ol><figure class=big-figure><a href=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Creating_an_Equipment_Class_and_Version.png target=_blank><img src=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Creating_an_Equipment_Class_and_Version.png alt="A new equipment class and version created in the UI." width=100%></a><figcaption class=caption>A new equipment class and version created in the UI.</figcaption></figure><h4 id=equipment-class-property>Equipment class property</h4><ol><li>From the properties tab, create a new property.</li><li>For type, select <code>BOUND</code>.</li><li>For name, enter <code>orderNumber</code>.</li><li>For UoM, select the unit of measure created earlier (<code>Order Number</code>).</li><li>Confirm by clicking the green tick icon.</li></ol><figure class=big-figure><a href=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Creating_an_Equipment_Class_Property.png target=_blank><img src=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Creating_an_Equipment_Class_Property.png alt="A new equipment class property created in the UI." width=100%></a><figcaption class=caption>A new equipment class property created in the UI.</figcaption></figure><h2 id=create-a-rule>Create a rule</h2><h3 id=add-a-rule-to-an-existing-equipment-class>Add a rule to an existing equipment class</h3><ol><li>From the Rules tab of an equipment class version, create a new rule.</li><li>Enter <code>Run BPMN on Order Number</code> for the name and confirm.</li><li>Select <code>rules_example_bpmn</code> for the workflow specification.</li><li>Add <code>orderNumber</code> as a trigger property.</li><li>Add a trigger expression that evaluates to true or false.</li></ol><div class="notices note"><span class=type>Note</span> The rule runs the preceding workflow only if the expression evaluates to <code>true</code>.
It’s common to compare the new value with the previous.</div><p>In this case, we can compare the new order number to the previous by adding <code>OrderNumber.current.value != OrderNumber.previous.value</code>.
Note that the root of the object path must match the ID of the equipment class property we set up earlier and all evaluations are case-sensitive.</p><p>The entire information that becomes available to the rule engine looks like this:</p><div class=tabs><ul class="nav nav-tabs"></ul><div class=tab-content><div class=tab-pane title="JSON INPUT"><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>{
</span></span><span style=display:flex><span>  orderNumber: {
</span></span><span style=display:flex><span>    current: {
</span></span><span style=display:flex><span>      bindingType: <span style=color:#a31515>&#34;BOUND&#34;</span>,
</span></span><span style=display:flex><span>      description: <span style=color:#a31515>&#34;bound prop&#34;</span>,
</span></span><span style=display:flex><span>      equipmentClassProperty: {
</span></span><span style=display:flex><span>        id: <span style=color:#a31515>&#34;EQCLASS1.10.orderNumber&#34;</span>,
</span></span><span style=display:flex><span>        iid: <span style=color:#a31515>&#34;0x2a78&#34;</span>,
</span></span><span style=display:flex><span>        label: <span style=color:#a31515>&#34;orderNumber&#34;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      equipmentVersion: {
</span></span><span style=display:flex><span>        equipment: {
</span></span><span style=display:flex><span>          id: <span style=color:#a31515>&#34;EQ1&#34;</span>,
</span></span><span style=display:flex><span>          iid: <span style=color:#a31515>&#34;0x1b&#34;</span>,
</span></span><span style=display:flex><span>          label: <span style=color:#a31515>&#34;EQ1&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        id: <span style=color:#a31515>&#34;EQ1&#34;</span>,
</span></span><span style=display:flex><span>        iid: <span style=color:#a31515>&#34;0x22&#34;</span>,
</span></span><span style=display:flex><span>        version: <span style=color:#a31515>&#34;2&#34;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      id: <span style=color:#a31515>&#34;EQCLASS1.10.orderNumber&#34;</span>,
</span></span><span style=display:flex><span>      label: <span style=color:#a31515>&#34;orderNumber&#34;</span>,
</span></span><span style=display:flex><span>      messageKey: <span style=color:#a31515>&#34;ns=3;i=1003.1695170450000000000&#34;</span>,
</span></span><span style=display:flex><span>      propertyType: <span style=color:#a31515>&#34;DefaultType&#34;</span>,
</span></span><span style=display:flex><span>      serverPicoseconds: 0,
</span></span><span style=display:flex><span>      serverTimestamp: <span style=color:#a31515>&#34;2023-09-20T00:40:50.028Z&#34;</span>,
</span></span><span style=display:flex><span>      sourcePicoseconds: 0,
</span></span><span style=display:flex><span>      sourceTimestamp: <span style=color:#a31515>&#34;2023-09-20T00:40:50Z&#34;</span>,
</span></span><span style=display:flex><span>      value: <span style=color:#a31515>&#34;Order2&#34;</span>,
</span></span><span style=display:flex><span>      valueUnitOfMeasure: {
</span></span><span style=display:flex><span>        dataType: <span style=color:#a31515>&#34;FLOAT&#34;</span>,
</span></span><span style=display:flex><span>        id: <span style=color:#a31515>&#34;FLOAT&#34;</span>,
</span></span><span style=display:flex><span>        iid: <span style=color:#a31515>&#34;0x28&#34;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    previous: {
</span></span><span style=display:flex><span>      bindingType: <span style=color:#a31515>&#34;BOUND&#34;</span>,
</span></span><span style=display:flex><span>      description: <span style=color:#a31515>&#34;bound prop&#34;</span>,
</span></span><span style=display:flex><span>      equipmentClassProperty: {
</span></span><span style=display:flex><span>        id: <span style=color:#a31515>&#34;EQCLASS1.10.orderNumber&#34;</span>,
</span></span><span style=display:flex><span>        iid: <span style=color:#a31515>&#34;0x2a78&#34;</span>,
</span></span><span style=display:flex><span>        label: <span style=color:#a31515>&#34;orderNumber&#34;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      equipmentVersion: {
</span></span><span style=display:flex><span>        equipment: {
</span></span><span style=display:flex><span>          id: <span style=color:#a31515>&#34;EQ1&#34;</span>,
</span></span><span style=display:flex><span>          iid: <span style=color:#a31515>&#34;0x1b&#34;</span>,
</span></span><span style=display:flex><span>          label: <span style=color:#a31515>&#34;EQ1&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        id: <span style=color:#a31515>&#34;EQ1&#34;</span>,
</span></span><span style=display:flex><span>        iid: <span style=color:#a31515>&#34;0x22&#34;</span>,
</span></span><span style=display:flex><span>        version: <span style=color:#a31515>&#34;2&#34;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      id: <span style=color:#a31515>&#34;EQCLASS1.10.orderNumber&#34;</span>,
</span></span><span style=display:flex><span>      label: <span style=color:#a31515>&#34;orderNumber&#34;</span>,
</span></span><span style=display:flex><span>      messageKey: <span style=color:#a31515>&#34;ns=3;i=1003.1695170440000000000&#34;</span>,
</span></span><span style=display:flex><span>      propertyType: <span style=color:#a31515>&#34;DefaultType&#34;</span>,
</span></span><span style=display:flex><span>      serverPicoseconds: 0,
</span></span><span style=display:flex><span>      serverTimestamp: <span style=color:#a31515>&#34;2023-09-20T00:40:40.003Z&#34;</span>,
</span></span><span style=display:flex><span>      sourcePicoseconds: 0,
</span></span><span style=display:flex><span>      sourceTimestamp: <span style=color:#a31515>&#34;2023-09-20T00:40:40Z&#34;</span>,
</span></span><span style=display:flex><span>      value: <span style=color:#a31515>&#34;Order1&#34;</span>,
</span></span><span style=display:flex><span>      valueUnitOfMeasure: {
</span></span><span style=display:flex><span>        dataType: <span style=color:#a31515>&#34;FLOAT&#34;</span>,
</span></span><span style=display:flex><span>        id: <span style=color:#a31515>&#34;FLOAT&#34;</span>,
</span></span><span style=display:flex><span>        iid: <span style=color:#a31515>&#34;0x28&#34;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><div class=tab-pane title=EXPRESSION><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a31515>`OrderNumber.current.value != OrderNumber.previous.value`</span>
</span></span></code></pre></div></div><div class=tab-pane title=OUTPUT><pre tabindex=0><code>True
</code></pre><p>The expression evaluates to <code>false</code>, because the <code>current</code> and <code>previous</code> values differ.</p></div></div></div><p>Optionally, pass information to the BPMN by adding a payload message. The message is an object with multiple keys.</p><ol><li>Enter <code>orderNumber</code> for the field name.</li><li>Enter <code>orderNumber.current.value</code> for the JSON expression.</li><li>Confirm by clicking the green tick icon.</li><li><strong>Create</strong>.</li><li>From the <strong>General</strong> tab, change the equipment class version state to active.</li></ol><figure class=big-figure><a href=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Creating_a_Rule.png target=_blank><img src=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Creating_a_Rule.png alt="Creating an equipment class rule in the UI." width=100%></a><figcaption class=caption>Creating an equipment class rule in the UI.</figcaption></figure><h3 id=associate-an-equipment-with-a-bound-property>Associate an equipment with a bound property</h3><p>The final steps to setting up a rule are to:</p><ol><li>Create a new equipment version.</li><li>Link it to a data source.</li><li>Set up bound properties.</li></ol><h4 id=create-an-equipment-and-version>Create an equipment and version</h4><ol><li>From the Main Menu, navigate to <strong>Master Data > Equipment</strong>.</li><li>Select a piece of equipment. If none, create one called <code>Line 1</code>.</li><li>From the <strong>General</strong> tab, <strong>Create</strong>.</li><li>Link the version to the equipment class you created earlier (<code>Pizza Line</code>).</li><li>Save the version to create it.</li></ol><figure class=big-figure><a href=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Creating_an_Equipment_and_Version.png target=_blank><img src=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Creating_an_Equipment_and_Version.png alt="A new equipment class and version created in the UI." width=100%></a><figcaption class=caption>A new equipment class and version created in the UI.</figcaption></figure><h4 id=link-a-data-source>Link a data source</h4><ol><li>From the <strong>Data Sources</strong> tab, link the equipment version to the data source you created in the previous section.</li></ol><figure class=big-figure><a href=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Link_Equipment_to_Data_Source.png target=_blank><img src=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Link_Equipment_to_Data_Source.png alt="An equipment linked to a data source in the UI." width=100%></a><figcaption class=caption>An equipment linked to a data source in the UI.</figcaption></figure><h4 id=set-up-the-bound-property>Set up the bound property</h4><ol><li>From the <strong>Properties</strong> tab, find a property that you want this equipment to inherit and select the binding icon.</li><li>If you chose the property <code>orderNumber</code>, add the topic <code>Oven/OrderNumber</code> you added previously.</li></ol><figure class=big-figure><a href=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Binding_an_Equipment_Property_to_a_Topic.png target=_blank><img src=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Binding_an_Equipment_Property_to_a_Topic.png alt="An equipment property bound to a data source topic in the UI." width=100%></a><figcaption class=caption>An equipment property bound to a data source topic in the UI.</figcaption></figure><h2 id=test-the-binding-and-the-rule>Test the binding and the rule</h2><p>Send a message to test that the value of the property <code>orderNumber</code> of the equipment <code>Line 1</code> is bound to the topic <code>Oven/OrderNumber</code>.</p><h3 id=test-using-an-mqtt-client>Test using an MQTT client</h3><p>For example, using MQTT Explorer:</p><ol><li>Open MQTT Explorer and connect to the broker.</li></ol><p>The microservice Libre Agent (<code>libre-agent</code>) should immediately publish a message to indicate the data source topic <code>Oven/OrderNumber</code> has been set up successfully.</p><figure class=big-figure><a href=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Libre_Agent_has_Connected_to_the_Data_Source.png target=_blank><img src=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Libre_Agent_has_Connected_to_the_Data_Source.png alt="The Libre Agent has connected to the data source." width=65%></a><figcaption class=caption>The Libre Agent has connected to the data source.</figcaption></figure><ol start=2><li>Publish the string <code>Order1</code> to the topic <code>Oven/OrderNumber</code>.</li></ol><figure class=big-figure><a href=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Publish_Order_Number_to_NATS.png target=_blank><img src=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Publish_Order_Number_to_NATS.png alt="A new order number was published to the data source." width=65%></a><figcaption class=caption>A new order number was published to the data source.</figcaption></figure><p>If the message has been received,
a new topic, <code>Oven</code>, appears with its subtopic <code>OrderNumber</code>.</p><p>If there is an equipment property bound to this topic,
a topic called <code>MQTT/&lt;DATA_SOURCE_NAME>/ValueChanged</code> also appears.
In addition, the published value should show in the column <code>Expression</code> of the equipment property <code>orderNumber</code>.</p><figure class=big-figure><a href=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-New_orderNumber_in_the_Admin_UI.png target=_blank><img src=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-New_orderNumber_in_the_Admin_UI.png alt="The bound property assumes the last value published to the data source." width=100%></a><figcaption class=caption>The bound property assumes the last value published to the data source.</figcaption></figure><div class="notices note"><span class=type>Note</span> If this is the first message published to the topic, the rule will not be triggered because Rhize has no previous value to compare it the message value to. However, if you publish another order number, a new topic called <code>Core</code> will show up containing a subtopic called <code>RuleTriggered</code> to indicate that the rule has indeed been triggered.</div><figure class=big-figure><a href=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Rule_Triggered_in_broker.png target=_blank><img src=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Rule_Triggered_in_broker.png alt="The rule engine has published a message to indicate that the equipment class rule has indeed been triggered." width=65%></a><figcaption class=caption>The rule engine has published a message to indicate that the equipment class rule has indeed been triggered.</figcaption></figure><h3 id=confirm-in-execution-in-tempo>Confirm in execution in Tempo</h3><p>To confirm the intended BPMN was executed, navigate to Grafana (Tempo) and look for a trace containing the expected BPMN ID.</p><figure class=big-figure><a href=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Executed_BPMNs_in_Grafana.png target=_blank><img src=https://docs.rhize.com/images/equipment-class-rules/screenshot-rhize-Executed_BPMNs_in_Grafana.png alt="Grafana shows a recent trace with the id of the target BPMN." width=100%></a><figcaption class=caption>Grafana shows a recent trace with the id of the target BPMN.</figcaption></figure><h2 id=video-example>Video example</h2><ul><li>&#x1f3a5; <a href="https://www.youtube.com/watch?v=y5lr9JRmxDA">Trigger BPMN</a>. This video provides an example of creating a rule based on values for an OPC UA server in a baking process.</li></ul><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script></article><div class=right-toc><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#set-up-configure-equipment-and-workflows>Set up: configure equipment and workflows</a><ul><li><a href=#create-a-data-source>Create a data source</a></li><li><a href=#create-a-data-source-topic>Create a data source topic</a></li><li><a href=#create-a-unit-of-measure>Create a unit of measure</a></li><li><a href=#creating-a-bpmn-workflow>Creating a BPMN workflow</a></li><li><a href=#create-an-equipment-class-with-bound-properties>Create an equipment class with bound properties</a></li></ul></li><li><a href=#create-a-rule>Create a rule</a><ul><li><a href=#add-a-rule-to-an-existing-equipment-class>Add a rule to an existing equipment class</a></li><li><a href=#associate-an-equipment-with-a-bound-property>Associate an equipment with a bound property</a></li></ul></li><li><a href=#test-the-binding-and-the-rule>Test the binding and the rule</a><ul><li><a href=#test-using-an-mqtt-client>Test using an MQTT client</a></li><li><a href=#confirm-in-execution-in-tempo>Confirm in execution in Tempo</a></li></ul></li><li><a href=#video-example>Video example</a></li></ul></nav></div></div></main><script type=text/javascript src=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js></script><script src=https://docs.rhize.com/js/clipboard.min.js></script><script src=https://docs.rhize.com/js/dgraph.js?a9873668f1334ff6c49d4edea0a4bc38></script><script>hljs.initHighlightingOnLoad()</script></body></html>