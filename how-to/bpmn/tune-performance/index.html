<!doctype html><html lang=en class="js csstransforms3d"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-0PJKXDWQ4P"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0PJKXDWQ4P")}</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=referrer content="no-referrer-when-downgrade"><meta property="og:image" content="https://docs.rhize.com/images/rhize-logo.png"><meta property="og:image:secure_url" content="https://docs.rhize.com/images/rhize-logo.png"><meta property="og:description" content="Tips to debug and improve the performance of your BPMN process"><meta property="og:type" content="website"><meta property="og:title" content="Tune BPMN performance"><meta property="og:site_name" content="Rhize documentation"><meta property="og:url" content="https://docs.rhize.com/how-to/bpmn/tune-performance/"><meta property="og:locale" content="en"><meta name=generator content="Hugo 0.126.1"><meta name=description content="Tips to debug and improve the performance of your BPMN process"><link rel=canonical href=https://docs.rhize.com/how-to/bpmn/tune-performance/><link rel=apple-touch-icon sizes=57x57 href=https://docs.rhize.com/images/favicons/apple-touch-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=https://docs.rhize.com/images/favicons/apple-touch-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=https://docs.rhize.com/images/favicons/apple-touch-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=https://docs.rhize.com/images/favicons/apple-touch-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=https://docs.rhize.com/images/favicons/apple-touch-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=https://docs.rhize.com/images/favicons/apple-touch-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=https://docs.rhize.com/images/favicons/apple-touch-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=https://docs.rhize.com/images/favicons/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=https://docs.rhize.com/images/favicons/apple-touch-icon-180x180.png><link rel=icon type=image/png href=https://docs.rhize.com/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://docs.rhize.com/images/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=https://docs.rhize.com/images/favicons/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=https://docs.rhize.com/images/favicons/favicon-16x16.png sizes=16x16><link rel=manifest href=https://docs.rhize.com/images/favicons/manifest.webmanifest><link rel=mask-icon href=https://docs.rhize.com/images/favicons/safari-pinned-tab.svg color=#fe2c06><link rel="shortcut icon" href=https://docs.rhize.com/images/favicons/favicon.ico><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/default.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js></script><script async src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/languages/go.min.js></script><script async src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/languages/java.min.js integrity="sha256-RyOs5MjQ+Ef9DQrPHp4QGr2tcNjxLh6mCkkW+sS4doU=" crossorigin=anonymous></script><script src=//code.jquery.com/jquery-3.2.1.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><title>Tune BPMN performance
|
How to
</title><link href=https://docs.rhize.com/css/theme.css?07639695cdaf2b91d81cbbea8d450140 rel=stylesheet><link href=https://docs.rhize.com/css/runnable.css?46648956d99faa2e057d109b9f2a52e6 rel=stylesheet><link href=https://docs.rhize.com/css/tabs.css?035edc32762cb7973b740e3067101ced rel=stylesheet><link href=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css rel=stylesheet integrity=sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ crossorigin=anonymous><script src=//cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js integrity=sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js integrity=sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn crossorigin=anonymous></script><link href="//fonts.googleapis.com/css?family=Lato:400,700" rel=stylesheet><link href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css rel=stylesheet integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous><link href=https://cdn.lineicons.com/2.0/LineIcons.css rel=stylesheet crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3></head><body><nav id=header><div class=header-left><div><a href=https://docs.rhize.com/ class=brand><img src=https://docs.rhize.com//images/rhize-logo.png alt=RHIZE class=logo></a><div class=logo-tagline><span>Documentation</span></div></div></div><div class=header-right><div id=docsearch><div class="menu-search align-middle"><div id=docsearch></div></div></div><div><ul class=menu><li><a href=https://rhize.com target=_blank>Home</a></li><li><a href=https://forum.rhize.com target=_blank>Community</a></li><li><a href=https://github.com/libremfg/libremfg.github.io target=_blank>GitHub</a></li></ul></div></div><a href=# id=sidebar-toggle><i class="fa fa-bars"></i></a></nav><aside id=sidebar><ul class=topics><li class="topic main-topic children"><a id=get-started href=#>Get started</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/get-started/introduction/>What is Rhize?</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/get-started/how-rhize-works/>How Rhize works</a></li></ul></li><li class="topic main-topic children"><a id=deploy href=#>Deploy</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=#>Install</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/install/overview/>Overview</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/install/setup-kubernetes/>Set up Kubernetes</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/install/keycloak/>Configure Keycloak</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/install/services/>Install Rhize services</a></li></ul></li><li class="topic sub-topic"><a href=#>Back up</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/backup/graphdb/>Back up the Graph DB</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/backup/audit/>Back up Audit PostgreSQL</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/backup/grafana/>Back up Grafana</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/backup/keycloak/>Back up Keycloak</a></li></ul></li><li class="topic sub-topic"><a href=#>Restore</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/restore/graphdb/>Restore the GraphDB</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/restore/audit/>Restore Audit backup</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/restore/grafana/>Restore Grafana</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/restore/keycloak/>Restore Keycloak</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/restore/bpmn-nodes/>BPMN execution recovery</a></li></ul></li><li class="topic sub-topic"><a href=#>Maintain</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/maintain/audit/>Archive the PostgreSQL Audit trail</a></li></ul></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/upgrade/>Upgrade</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/deploy/about-openidconnect/>About OpenID connect</a></li></ul></li><li class="topic main-topic children active"><a id=user-guides href=#>User guides</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=#>Define production models</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/model/create-objects-ui/>Create objects from the UI</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/model/master-definitions/>Master definitions and fields</a></li></ul></li><li class="topic sub-topic"><a href=#>Connect event data</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/publish-subscribe/connect-datasource/>Connect data source</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/publish-subscribe/turn-value-into-event/>Turn values into events</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/publish-subscribe/track-changes/>Track changes (CDC)</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/publish-subscribe/tutorial-create-equipment-class-rule/>Tutorial: Trigger a workflow from a rule</a></li></ul></li><li class="topic sub-topic active"><a href=#>Write BPMN workflows</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/orchestration-overview/>Overview: orchestrate processes</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/create-workflow/>Create workflows</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/trigger-workflows/>Trigger workflows</a></li><li class="topic sub-topic active"><a href=https://docs.rhize.com/how-to/bpmn/tune-performance/>Tune performance</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/naming-conventions/>Naming conventions</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/bpmn/bpmn-elements/>BMPN elements</a></li></ul></li><li class="topic sub-topic"><a href=#>Use GraphQL</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/call-the-graphql-api/>Overview: the Rhize API</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/query/>Query</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/filter/>Filter</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/mutate/>Mutate</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/gql/subscribe/>Subscribe</a></li></ul></li><li class="topic sub-topic"><a href=https://docs.rhize.com/how-to/audit/>Audit</a></li></ul></li><li class="topic main-topic children"><a id=use-cases href=#>Use cases</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/use-cases/overview/>Overview</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/use-cases/ebr/>Electronic batch records</a></li></ul></li><li class="topic main-topic children"><a id=reference href=#>Reference</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=#>Service configuration</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/agent-configuration/>Agent configuration</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/audit-configuration/>Audit configuration</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/bpmn-configuration/>BPMN configuration</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/service-config/core-configuration/>Core configuration</a></li></ul></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/default-ports/>Default URLs and local ports</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/gql-types/>GQL types and filters</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/reference/glossary/>Glossary</a></li></ul></li><li class="topic main-topic children"><a id=explanations href=#>Explanations</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/explanations/manufacturing-data-hub/>Manufacturing Data Hub</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/explanations/isa-95-diagrams/>ISA-95 diagrams</a></li></ul></li><li class="topic main-topic children"><a id=releases href=#>Releases</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/3-0/>3.0.0</a></li><li class="topic sub-topic"><a href=#>Changelog</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0/>3.0.0 (general release)</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc09/>3.0.0rc09</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc08/>3.0.0rc08</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc07/>3.0.0rc07</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc06/>3.0.0rc06</a></li><li class="topic sub-topic"><a href=https://docs.rhize.com/releases/changelog/3-0-0rc05/>3.0.0rc05</a></li></ul></li></ul></li><li class="topic main-topic"><a href=https://docs.rhize.com/></a></li></ul></aside><script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3></script><script type=text/javascript>docsearch({appId:"70JLDGIDQA",apiKey:"2b4c57aa9d3d0386bf1a6df5b54eb3cf",indexName:"rhize",insights:!0,container:"#docsearch",debug:!1})</script></body></html><main class=content-wrapper><div class=content><div class=top-toc><nav id=TableOfContents><ul><li><a href=#manage-the-process-context-size>Manage the process context size</a><ul><li><a href=#be-mindful-of-variable-output>Be mindful of variable output</a></li><li><a href=#discard-unneeded-data-from-api-responses>Discard unneeded data from API responses</a></li><li><a href=#observe-payload-size>Observe payload size</a></li></ul></li><li><a href=#look-for-inefficient-execution-logic>Look for inefficient execution logic</a><ul><li><a href=#avoid-parallel-joins>Avoid parallel joins</a></li><li><a href=#control-wildcards-in-message-start-events>Control wildcards in message start events</a></li><li><a href=#avoid-loops>Avoid loops</a></li></ul></li><li><a href=#use-the-jsonata-book-extension>Use the JSONata book extension</a></li></ul></nav></div><article><a class=edit-btn target=_blank href=https://github.com/libremfg/libremfg.github.io/edit/main/content/how-to/bpmn/tune-performance.md><i class="fa fa-github-alt"></i> Edit Page</a><h1 class=post-title>Tune BPMN performance</h1><p>This page documents some tips to debug <a href=https://docs.rhize.com/how-to/bpmn/create-workflow/>BPMN workflows</a> and improve their performance.</p><p>Manufacturing events can generate a vast amount of data.
And a BPMN workflow can have any number of logical flows and data transformations.
So an inefficient BPMN process can introduce performance degradations.</p><h2 id=manage-the-process-context-size>Manage the process context size</h2><div class="notices note"><span class=type>Note</span> The max size of the process variable context comes from the default max payload size of NATS Jetstreams.
To increase this size, change your NATS configuration.</div><p>By default, the size of the <abbr title="The context and variables that are passed between tasks in a BPMN workflow">process variable context</abbr> is 1MB.
If the sum size of all variables exceeds this limit, the BPMN process fails to execute.</p><h3 id=be-mindful-of-variable-output>Be mindful of variable output</h3><p>Pay attention the overall size of your variables, especially when outputting to new variables.
For example, imagine an initial JSON payload, <code>data</code>, that is 600KB.
If a JSONata task slightly modifies and outputs it to a new variable, <code>data2</code>, the process variable context will exceed 1MB and the BPMN process will exit.</p><p>To work around this constraint, you can save memory by mutating variables.
That is, instead of outputting a new variable, you can output the transformed payload to the original variable name.</p><h3 id=discard-unneeded-data-from-api-responses>Discard unneeded data from API responses</h3><p>Additionally, in service tasks that call APIs, use the <strong>Response Transform Expression</strong> to minimize the returned data to only the necessary fields.
Rhize stores only the output of the expression, and discards the other part of the response. This is especially useful in service tasks that <a href=https://docs.rhize.com/how-to/bpmn/bpmn-elements/#call-rest-api>Call a REST API</a>, since you cannot precisely specify the fields in the response (as you can with a GraphQL query).</p><p>If you still struggle to find what objects create memory bottlenecks, use a tool to observe their footprint, as documented in the next section.</p><h3 id=observe-payload-size>Observe payload size</h3><p>Each element in a BPMN workflow passes, evaluates, or transforms a JSON body.
Any unnecessary fields occupy unnecessary space in the <abbr title="The context and variables that are passed between tasks in a BPMN workflow">process variable context</abbr>.
However, it&rsquo;s hard for a human to reason about the size of the inflight payload without a tool to provide measurements and context.</p><p>It&rsquo;s easier to find places to reduce the in-flight payload size if you can visualize its memory footprint.
We recommend the <a href=https://www.debugbear.com/json-size-analyzer>JSON site analyzer</a>, which presents a flame graph of the memory used by the objects in a JSON data structure.</p><figure><img src=https://docs.rhize.com/how-to/bpmn/screenshot-rhize-flamegraph-json.png alt="A simplified diagram of Rhize's architecture" width=70%><figcaption><p><em><small>The material lot object is dominating the size of this JSON payload. This a good place to start looking for optimizations.</small></em></p></figcaption></figure><h2 id=look-for-inefficient-execution-logic>Look for inefficient execution logic</h2><p>When you first write a workflow, you may use some logical flows slow down execution time.
If a process seems slow, look for these places to refactor performance.</p><h3 id=avoid-parallel-joins>Avoid parallel joins</h3><p>Running processes in <a href=https://docs.rhize.com/how-to/bpmn/bpmn-elements/#parallel-gateway>parallel</a> can increase the workflow&rsquo;s complexity.
Parallel joins in particular can also increase memory usage of the NATS service.</p><p>Where possible, prefer exclusive branching and sequential execution.
When a task requires concurrency, keep the amount of data processed and the complexity of the tasks to the minimum necessary.</p><h3 id=control-wildcards-in-message-start-events>Control wildcards in message start events</h3><p>BPMN message start tasks can start on any topic or data source. However, performance varies with the events that the start task subscribes to.</p><p>Subscribing to multiple wildcards can especially drag performance.
To avoid a possible performance hit, try to subscribe to an exact topic, or limit subscriptions to a single wildcard.</p><h3 id=avoid-loops>Avoid loops</h3><p>A BPMN process can loop back to a previous task node to repeat execution.
This process can also increase execution time.
If a process with a loop is taking too long to execute, consider refactoring the loop to process the variables as a batch in JSONata tasks.</p><h2 id=use-the-jsonata-book-extension>Use the JSONata book extension</h2><p>A BPMN process performs better when the JSONata transformations are precise.
A strategy to debug and minimize necessary computation is to break transformations into smaller steps.</p><p>If you use Visual Studio Code, consider the <a href="https://marketplace.visualstudio.com/items?itemName=bigbug.vscode-language-jsonata"><code>jsonata-language</code></a> extension.
Similar to a Jupyter notebook, the extension provides an interactive environment to write JSONata expressions and pass the output from one expression into the input of another.
Besides its benefit for monitoring performance, we have used it to incrementally build complex JSONata in a way that we can document and share (in the style of literate programming).</p></article><div class=right-toc><nav id=TableOfContents><ul><li><a href=#manage-the-process-context-size>Manage the process context size</a><ul><li><a href=#be-mindful-of-variable-output>Be mindful of variable output</a></li><li><a href=#discard-unneeded-data-from-api-responses>Discard unneeded data from API responses</a></li><li><a href=#observe-payload-size>Observe payload size</a></li></ul></li><li><a href=#look-for-inefficient-execution-logic>Look for inefficient execution logic</a><ul><li><a href=#avoid-parallel-joins>Avoid parallel joins</a></li><li><a href=#control-wildcards-in-message-start-events>Control wildcards in message start events</a></li><li><a href=#avoid-loops>Avoid loops</a></li></ul></li><li><a href=#use-the-jsonata-book-extension>Use the JSONata book extension</a></li></ul></nav></div></div></main><script type=text/javascript src=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js></script><script src=https://docs.rhize.com/js/clipboard.min.js></script><script src=https://docs.rhize.com/js/dgraph.js?a9873668f1334ff6c49d4edea0a4bc38></script><script>hljs.initHighlightingOnLoad()</script></body></html>